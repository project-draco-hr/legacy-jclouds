{
  RunningInstance server=null;
  while (server == null) {
    try {
      System.out.printf("%d: running instance%n",System.currentTimeMillis());
      Reservation reservation=client.getInstanceServices().runInstancesInRegion(Region.DEFAULT,null,"ami-7e28ca17",1,1,asType(InstanceType.M1_SMALL).withKeyName(keyPair.getKeyName()).withSecurityGroup(securityGroupName));
      server=Iterables.getOnlyElement(reservation.getRunningInstances());
    }
 catch (    HttpResponseException htpe) {
      if (htpe.getResponse().getStatusCode() == 400)       continue;
      throw htpe;
    }
  }
  assertNotNull(server.getId());
  serverId=server.getId();
  assertEquals(server.getInstanceState(),InstanceState.PENDING);
  server=blockUntilRunningInstanceActive(serverId);
  sshPing(server);
  System.out.printf("%d: %s ssh connection made%n",System.currentTimeMillis(),serverId);
}
