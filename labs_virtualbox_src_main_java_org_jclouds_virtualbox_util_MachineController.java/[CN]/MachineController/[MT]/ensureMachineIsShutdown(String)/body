{
  ISession session=machineUtils.sharedLockMachineAndApplyToSession(vmName,new Function<ISession,ISession>(){
    @Override public ISession apply(    ISession session){
      session.getConsole().powerButton();
      return session;
    }
  }
);
  checkState(new RetryableNumTimesPredicate<MachineState>(new MachineStatePredicate(manager.get().getVBox(),vmName),5,3L,TimeUnit.SECONDS).apply(MachineState.PoweredOff),"vm(%s) is not shutdown correctly",vmName);
  return checkNotNull(session,"session");
}
