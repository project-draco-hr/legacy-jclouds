{
  ISession session=null;
  IMachine machine=manager.get().getVBox().findMachine(vmName);
  while (!machine.getState().equals(MachineState.Running)) {
    try {
      session=machineUtils.applyForMachine(vmName,new LaunchMachineIfNotAlreadyRunning(manager.get(),executionType,""));
    }
 catch (    RuntimeException e) {
      if (e.getMessage().contains("org.virtualbox_4_1.VBoxException: VirtualBox error: The given session is busy (0x80BB0007)")) {
        throw e;
      }
 else       if (e.getMessage().contains("VirtualBox error: The object is not ready")) {
        continue;
      }
 else {
        throw e;
      }
    }
  }
  Uninterruptibles.sleepUninterruptibly(5,TimeUnit.SECONDS);
  String guestAdditionsInstalled=machineUtils.sharedLockMachineAndApplyToSession(vmName,new Function<ISession,String>(){
    @Override public String apply(    ISession session){
      int attempts=0;
      String guestAdditionsInstalled=null;
      while (!!session.getConsole().getGuest().getAdditionsVersion().isEmpty() && attempts < 3) {
        Uninterruptibles.sleepUninterruptibly(2,TimeUnit.SECONDS);
        guestAdditionsInstalled=session.getConsole().getGuest().getAdditionsVersion();
        attempts++;
      }
      return guestAdditionsInstalled;
    }
  }
);
  if (!Strings.nullToEmpty(guestAdditionsInstalled).isEmpty()) {
    waitVBoxServiceIsActive(vmName);
  }
  return checkNotNull(session,"session");
}
