{
  final Set<Image> images=Sets.newHashSet();
  logger.debug(">> providing vAppTemplates");
  for (  final NamedResource vDC : client.getDefaultOrganization().getVDCs().values()) {
    Map<String,NamedResource> resources=client.getVDC(vDC.getId()).getResourceEntities();
    Map<String,ListenableFuture<Void>> responses=Maps.newHashMap();
    for (    final NamedResource resource : resources.values()) {
      if (resource.getType().equals(VCloudMediaType.VAPPTEMPLATE_XML)) {
        responses.put(resource.getName(),ConcurrentUtils.makeListenable(executor.submit(new Callable<Void>(){
          @Override public Void call() throws Exception {
            OsFamily myOs=ComputeUtils.parseOsFamilyOrNull(resource.getName());
            Architecture arch=ComputeUtils.parseArchitectureOrNull(resource.getName());
            VAppTemplate template=client.getVAppTemplate(resource.getId());
            Location location=findLocationForResourceInVDC.apply(resource,vDC.getId());
            String name=getName(template.getName());
            images.add(new ImageImpl(resource.getId(),name,resource.getId(),location,template.getLocation(),ImmutableMap.<String,String>of(),template.getDescription(),"",myOs,name,arch,populateDefaultLoginCredentialsForImageStrategy.execute(template)));
            return null;
          }
        }
),executor));
      }
    }
    ConcurrentUtils.awaitCompletion(responses,executor,null,logger,"vAppTemplates in " + vDC);
  }
  return images;
}
