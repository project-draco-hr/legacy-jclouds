{
  this.strategy=env.context.getUtils().getInjector().getInstance(ListAttachedNicsImpl.class);
  privateIp=env.privateNetwork.listUnusedIps().get(0);
  assertNotNull(privateIp);
  externalIp=env.externalNetwork.listUnusedIps().get(0);
  assertNotNull(externalIp);
  publicIp=env.virtualDatacenter.listAvailablePublicIps().get(0);
  env.virtualDatacenter.purchasePublicIp(publicIp);
  publicIp=env.virtualDatacenter.findPurchasedPublicIp(IpPredicates.<PublicIp>address(publicIp.getIp()));
  assertNotNull(publicIp);
  env.virtualMachine.setNics(Lists.<Ip<?,?>>newArrayList(privateIp,externalIp,publicIp),Lists.<UnmanagedNetwork>newArrayList(env.unmanagedNetwork));
}
