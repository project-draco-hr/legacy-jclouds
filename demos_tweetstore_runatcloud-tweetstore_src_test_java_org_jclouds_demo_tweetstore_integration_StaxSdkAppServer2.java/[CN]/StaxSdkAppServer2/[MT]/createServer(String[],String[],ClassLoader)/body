{
  StaxSdkAppServerCLI cli=StaxSdkAppServerCLI.parse(args);
  if (cli.getMissingOptions().length > 0) {
    throw new ParseException("Missing required options: " + cli.formatMissingOptions(", "));
  }
  String[] environments=cli.getEnvironment();
  File serverConfig=cli.getServerConfigFile();
  File baseDir=new File(cli.getBaseDir());
  File webRoot=new File(cli.getWebdir());
  File workDir=new File(baseDir,"work");
  File staxWebXml=new File(webRoot,"WEB-INF/cloudbees-web.xml");
  if (!(staxWebXml.exists()))   staxWebXml=new File(webRoot,"WEB-INF/stax-web.xml");
  IAppServerConfiguration config=WarBasedServerConfiguration.load(serverConfig,webRoot,staxWebXml,environments);
  set("statusInterval",StaxReflect.getAppServerConfig(config),5);
  StaxSdkAppServer server=new StaxSdkAppServer(baseDir.getAbsolutePath(),workDir.getAbsolutePath(),cl,classPaths,cli.getPort(),config,cli.getRepositoryPath());
  return new StaxSdkAppServer2(server);
}
