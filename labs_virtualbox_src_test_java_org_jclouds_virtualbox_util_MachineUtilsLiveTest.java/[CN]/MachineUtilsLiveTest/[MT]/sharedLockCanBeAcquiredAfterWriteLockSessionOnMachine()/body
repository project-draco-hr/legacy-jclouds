{
  final IMachine clone=cloneFromMaster();
  try {
    ISession writeSession=machineUtils.writeLockMachineAndApplyToSession(clone.getName(),new Function<ISession,ISession>(){
      @Override public ISession apply(      ISession writeSession){
        checkState(writeSession.getState().equals(SessionState.Locked));
        return writeSession;
      }
    }
);
    checkState(writeSession.getState().equals(SessionState.Unlocked));
  }
  finally {
    undoVm(clone.getName());
  }
}
