{
  PrivateNetwork defaultNetwork=PrivateNetwork.builder(context).name("DefaultNetwork").gateway("192.168.1.1").address("192.168.1.0").mask(24).build();
  VirtualDatacenter vdc=VirtualDatacenter.builder(context,datacenter,enterprise).network(defaultNetwork).build();
  for (  HypervisorType type : HypervisorType.values()) {
    if (isTemplateCompatibleWithHypervisor(template,type)) {
      try {
        logger.info("Trying to create a virtual datacenter of type %s",type.name());
        vdc.setName(name != null ? name : "JC-" + type.name());
        vdc.setHypervisorType(type);
        vdc.save();
        logger.info("Virtual datacenter created");
        return vdc;
      }
 catch (      AbiquoException ex) {
        if (ex.hasError("VDC-1")) {
          continue;
        }
 else {
          throw ex;
        }
      }
    }
  }
  logger.warn("Could not create a compatible virtual datacenter for template of type %s",template.getDiskFormatType().name());
  return null;
}
