{
  String region=template.getLocation() == null ? defaultRegion : template.getLocation().getId();
  ServerClient serverClient=template.getLocation() != null ? novaClient.getServerClientForRegion(template.getLocation().getId()) : defaultLocationServerClient;
  NovaTemplateOptions templateOptions=NovaTemplateOptions.class.cast(template.getOptions());
  boolean autoAllocateFloatingIps=(this.autoAllocateFloatingIps || templateOptions.isAutoAssignFloatingIp());
  String floatingIp=null;
  if (autoAllocateFloatingIps) {
    checkArgument(novaClient.getFloatingIPExtensionForRegion(region).isPresent(),"Floating IP settings are required by configuration, but the extension is not available!");
    floatingIp=novaClient.getFloatingIPExtensionForRegion(region).get().allocate().getId();
  }
  Server server=serverClient.createServer(name,template.getImage().getId(),template.getHardware().getId());
  if (floatingIp != null)   novaClient.getFloatingIPExtensionForRegion(region).get().addFloatingIP(server.getId(),floatingIp);
  return new NodeAndInitialCredentials<Server>(server,server.getId() + "",LoginCredentials.builder().password(server.getAdminPass()).build());
}
