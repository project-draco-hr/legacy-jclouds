{
  try {
    IMachine source=getSourceNode();
    CloneSpec cloneSpec=CloneSpec.builder().vm(clonedVmSpec).network(cloneNetworkSpec).master(source).linked(IS_LINKED_CLONE).build();
    if (source.getCurrentSnapshot() != null) {
      ISession session=manager.get().openMachineSession(source);
      session.getConsole().deleteSnapshot(source.getCurrentSnapshot().getId());
      session.unlockMachine();
    }
    IMachine clone=new CloneAndRegisterMachineFromIMachineIfNotAlreadyExists(manager,workingDir,machineUtils).apply(cloneSpec);
    assertEquals(clone.getName(),cloneSpec.getVmSpec().getVmName());
    new LaunchMachineIfNotAlreadyRunning(manager.get(),ExecutionType.GUI,"").apply(clone);
  }
  finally {
    for (    VmSpec spec : ImmutableSet.of(cloneSpec.getVmSpec(),sourceMachineSpec.getVmSpec()))     undoVm(spec);
  }
}
