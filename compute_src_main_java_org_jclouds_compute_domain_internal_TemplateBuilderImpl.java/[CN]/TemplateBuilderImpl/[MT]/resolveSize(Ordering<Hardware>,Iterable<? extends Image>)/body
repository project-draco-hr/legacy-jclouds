{
  Set<? extends Hardware> hardwarel=hardwares.get();
  Hardware hardware;
  try {
    Iterable<? extends Hardware> hardwaresThatAreCompatibleWithOurImages=filter(hardwarel,new Predicate<Hardware>(){
      @Override public boolean apply(      final Hardware hardware){
        return Iterables.any(images,new Predicate<Image>(){
          @Override public boolean apply(          Image input){
            return hardware.supportsImage().apply(input);
          }
          @Override public String toString(){
            return "hardware(" + hardware + ").supportsImage()";
          }
        }
);
      }
    }
);
    hardware=hardwareOrdering.max(filter(hardwaresThatAreCompatibleWithOurImages,hardwarePredicate));
  }
 catch (  NoSuchElementException exception) {
    String message=format("no hardware profiles support images matching params: %s",toString());
    exception=new NoSuchElementException(message);
    if (logger.isTraceEnabled())     logger.warn(exception,"hardware profiles %s\nimage ids %s",hardwarel,transform(images,imageToId));
    throw exception;
  }
  logger.debug("<<   matched hardware(%s)",hardware.getId());
  return hardware;
}
