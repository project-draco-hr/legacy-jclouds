{
  Long slotId=30l;
  IMachine machine=createMock(IMachine.class);
  INetworkAdapter networkAdapter=createMock(INetworkAdapter.class);
  INATEngine natEngine=createMock(INATEngine.class);
  String error="VirtualBox error: Argument slot is invalid " + "(must be slot < RT_ELEMENTS(mNetworkAdapters)) (0x80070057)";
  VBoxException invalidSlotException=new VBoxException(createNiceMock(Throwable.class),error);
  expect(machine.getNetworkAdapter(slotId)).andThrow(invalidSlotException);
  replay(machine,networkAdapter,natEngine);
  NatAdapter natAdapter=NatAdapter.builder().tcpRedirectRule("127.0.0.1",2222,"",22).build();
  new AttachNATAdapterToMachineIfNotAlreadyExists(slotId,natAdapter).apply(machine);
  verify(machine,networkAdapter,natEngine);
}
