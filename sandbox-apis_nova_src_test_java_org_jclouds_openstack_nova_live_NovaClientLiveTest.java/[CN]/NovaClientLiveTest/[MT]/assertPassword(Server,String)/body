{
  IPSocket socket=new IPSocket(Iterables.get(server.getAddresses().getPublicAddresses(),0).getAddress(),22);
  SshClient client=sshFactory.create(socket,new Credentials("root",keyPair.get("private")));
  try {
    client.connect();
    Payload etcPasswd=client.get("/etc/jclouds.txt");
    String etcPasswdContents=Strings2.toStringAndClose(etcPasswd.getInput());
    assertEquals("rackspace",etcPasswdContents.trim());
  }
  finally {
    if (client != null)     client.disconnect();
  }
}
