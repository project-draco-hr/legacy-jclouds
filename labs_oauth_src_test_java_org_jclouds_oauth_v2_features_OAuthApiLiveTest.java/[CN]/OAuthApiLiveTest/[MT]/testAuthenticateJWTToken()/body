{
  assertTrue(properties != null,"properties were not set");
  String signatureAlgorithm=getMandatoryProperty(properties,SIGNATURE_OR_MAC_ALGORITHM);
  checkState(OAuthConstants.OAUTH_ALGORITHM_NAMES_TO_SIGNATURE_ALGORITHM_NAMES.containsKey(signatureAlgorithm),String.format("Algorithm not supported: " + signatureAlgorithm));
  Header header=Header.builder().signerAlgorithm(signatureAlgorithm).type("JWT").build();
  String scopes=getMandatoryProperty(properties,SCOPES);
  String audience=getMandatoryProperty(properties,AUDIENCE);
  long now=nowInSeconds();
  ClaimSet claimSet=ClaimSet.builder().addClaim("aud",audience).addClaim("scope",scopes).addClaim("iss",identity).emissionTime(now).expirationTime(now + 3600).build();
  TokenRequest tokenRequest=TokenRequest.builder().header(header).claimSet(claimSet).build();
  Token token=context.getApi().authenticate(tokenRequest);
  assertNotNull(token);
}
