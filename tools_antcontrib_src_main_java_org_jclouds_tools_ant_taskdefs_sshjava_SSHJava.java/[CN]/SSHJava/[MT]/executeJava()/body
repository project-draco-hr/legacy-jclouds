{
  checkNotNull(jvm,"jvm must be set");
  checkNotNull(remoteDirectory,"remotedir must be set");
  if (localDirectory != null) {
    FileSet cwd=new FileSet();
    cwd.setDir(localDirectory);
    mkdirAndCopyTo(remoteDirectory.getAbsolutePath(),ImmutableList.of(cwd));
  }
  if (getCommandLine().getClasspath() != null) {
    copyPathTo(getCommandLine().getClasspath(),remoteDirectory.getAbsolutePath() + "/classpath");
  }
  if (getCommandLine().getBootclasspath() != null) {
    copyPathTo(getCommandLine().getBootclasspath(),remoteDirectory.getAbsolutePath() + "/bootclasspath");
  }
  String command=convertJavaToScriptNormalizingPaths(getCommandLine());
  String random=new SecureRandom().nextInt() + "";
  exec.setResultProperty(random);
  exec.setFailonerror(false);
  exec.setCommand(command);
  exec.setError(errorFile);
  exec.setErrorproperty(errorProperty);
  exec.setOutput(outputFile);
  exec.setOutputproperty(outputProperty);
  exec.setAppend(append);
  exec.execute();
  return Integer.parseInt(getProject().getProperty(random));
}
