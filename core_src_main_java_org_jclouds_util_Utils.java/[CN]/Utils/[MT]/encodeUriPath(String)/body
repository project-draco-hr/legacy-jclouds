{
  String path, params="";
  int offset;
  if ((offset=uri.indexOf('?')) >= 0) {
    path=uri.substring(0,offset);
    params=uri.substring(offset);
  }
 else {
    path=uri;
  }
  String encodedUri;
  try {
    encodedUri=URLEncoder.encode(path,"UTF-8");
  }
 catch (  UnsupportedEncodingException e) {
    encodedUri=URLEncoder.encode(path);
  }
  return encodedUri.replace("%2F","/") + params;
}
