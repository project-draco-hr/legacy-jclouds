{
  String user=identity.substring(0,identity.lastIndexOf('@'));
  String org=identity.substring(identity.lastIndexOf('@') + 1);
  String password=credential;
  String authHeader="Basic " + CryptoStreams.base64(String.format("%s@%s:%s",checkNotNull(user),checkNotNull(org),checkNotNull(password)).getBytes("UTF-8"));
  HttpResponse response=context.getUtils().getHttpClient().invoke(HttpRequest.builder().method(method).endpoint(endpoint + "/login").addHeader("Authorization",authHeader).addHeader("Accept","*/*").build());
  sessionWithToken=SessionWithToken.builder().session(session).token(response.getFirstHeaderOrNull("x-vcloud-authorization")).build();
  assertEquals(sessionWithToken.getSession().getUser(),user);
  assertEquals(sessionWithToken.getSession().get(),org);
  assertTrue(sessionWithToken.getSession().getLinks().size() > 0);
  assertNotNull(sessionWithToken.getToken());
  OrgList orgList=parser.fromXML(Strings2.toString(response.getPayload()),OrgList.class);
  assertTrue(orgList.size() > 0,"must have orgs");
  context.getApi().getOrgApi().get(Iterables.getLast(orgList).getHref());
}
