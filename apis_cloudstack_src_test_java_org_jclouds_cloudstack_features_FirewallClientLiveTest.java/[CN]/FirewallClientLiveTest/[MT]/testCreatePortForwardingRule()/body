{
  if (networksDisabled)   return;
  while (portForwardingRule == null) {
    ip=reuseOrAssociate.apply(network);
    try {
      AsyncCreateResponse job=client.getFirewallClient().createPortForwardingRuleForVirtualMachine(vm.getId(),ip.getId(),"tcp",22,22);
      assertTrue(jobComplete.apply(job.getJobId()));
      portForwardingRule=client.getFirewallClient().getPortForwardingRule(job.getId());
    }
 catch (    IllegalStateException e) {
    }
  }
  assertEquals(portForwardingRule.getIPAddressId(),ip.getId());
  assertEquals(portForwardingRule.getVirtualMachineId(),vm.getId());
  assertEquals(portForwardingRule.getPublicPort(),22);
  assertEquals(portForwardingRule.getProtocol(),"tcp");
  checkPortForwardingRule(portForwardingRule);
  checkSSH(new IPSocket(ip.getIPAddress(),22));
}
