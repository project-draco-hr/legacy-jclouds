{
  List<IMedium> mediaToBeDeleted=Collections.emptyList();
  IMachine machine=null;
  try {
    machine=manager.getVBox().findMachine(vmSpec.getVmName());
    mediaToBeDeleted=machine.unregister(vmSpec.getCleanupMode());
  }
 catch (  VBoxException e) {
    ErrorCode errorCode=ErrorCode.valueOf(e);
switch (errorCode) {
case VBOX_E_OBJECT_NOT_FOUND:
      logger.debug("Machine %s does not exists, cannot unregister",vmSpec.getVmName());
    break;
default :
  throw e;
}
}
if (!mediaToBeDeleted.isEmpty()) {
try {
for (IMedium iMedium : mediaToBeDeleted) {
  if (iMedium.getDeviceType().equals(DeviceType.HardDisk)) {
    IProgress deletion=machine.delete(mediaToBeDeleted);
    deletion.waitForCompletion(-1);
  }
}
}
 catch (Exception e) {
logger.error(e,"Problem in deleting the media attached to %s",machine.getName());
propagate(e);
}
}
return null;
}
