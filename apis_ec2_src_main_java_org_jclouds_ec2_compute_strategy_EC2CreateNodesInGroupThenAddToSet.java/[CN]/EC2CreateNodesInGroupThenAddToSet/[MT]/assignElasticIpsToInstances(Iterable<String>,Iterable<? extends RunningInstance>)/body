{
  if (!autoAllocateElasticIps)   return;
  int i=0;
  for (  RunningInstance startedInstance : startedInstances) {
    String ip=Iterables.get(ips,i);
    String region=startedInstance.getRegion();
    String id=startedInstance.getId();
    RegionAndName coordinates=new RegionAndName(region,id);
    logger.debug(">> awaiting status running instance(%s)",coordinates);
    AtomicReference<NodeMetadata> node=new AtomicReference<NodeMetadata>(runningInstanceToNodeMetadata.apply(startedInstance));
    nodeRunning.apply(node);
    logger.trace("<< running instance(%s)",coordinates);
    logger.debug(">> associating elastic IP %s to instance %s",ip,coordinates);
    client.getElasticIPAddressServices().associateAddressInRegion(region,ip,id);
    logger.trace("<< associated elastic IP %s to instance %s",ip,coordinates);
    elasticIpCache.put(coordinates,ip);
  }
}
