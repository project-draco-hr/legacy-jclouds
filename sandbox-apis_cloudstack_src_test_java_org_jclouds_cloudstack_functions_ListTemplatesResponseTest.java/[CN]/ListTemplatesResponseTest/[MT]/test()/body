{
  InputStream is=getClass().getResourceAsStream("/listtemplatesresponse.json");
  Set<Template> expects=ImmutableSortedSet.<Template>of(Template.builder().id(2).name("CentOS 5.3(64-bit) no GUI (XenServer)").displayText("CentOS 5.3(64-bit) no GUI (XenServer)").isPublic(true).created(new SimpleDateFormatDateService().iso8601SecondsDateParse("2011-02-11T18:45:54-0800")).ready(true).passwordEnabled(false).format(Format.VHD).featured(true).crossZones(true).OSTypeId(11).OSType("CentOS 5.3 (32-bit)").account("system").zoneId(1).zone("San Jose 1").size(8589934592l).type(Template.Type.BUILTIN).hypervisor("XenServer").domain("ROOT").domainId(1).extractable(true).build(),Template.builder().id(4).name("CentOS 5.5(64-bit) no GUI (KVM)").displayText("CentOS 5.5(64-bit) no GUI (KVM)").isPublic(true).created(new SimpleDateFormatDateService().iso8601SecondsDateParse("2011-02-11T18:45:54-0800")).ready(true).passwordEnabled(false).format(Format.QCOW2).featured(true).crossZones(true).OSTypeId(112).OSType("CentOS 5.5 (64-bit)").account("system").zoneId(1).zone("San Jose 1").size(8589934592l).type(Type.BUILTIN).hypervisor("KVM").domain("ROOT").domainId(1).extractable(true).build(),Template.builder().id(7).name("CentOS 5.3(64-bit) no GUI (vSphere)").displayText("CentOS 5.3(64-bit) no GUI (vSphere)").isPublic(true).created(new SimpleDateFormatDateService().iso8601SecondsDateParse("2011-02-11T18:45:54-0800")).ready(true).passwordEnabled(false).format(Format.OVA).featured(true).crossZones(true).OSTypeId(12).OSType("CentOS 5.3 (64-bit)").account("system").zoneId(1).zone("San Jose 1").size(459320832l).type(Type.BUILTIN).hypervisor("VMware").domain("ROOT").domainId(1).extractable(true).build());
  UnwrapOnlyNestedJsonValue<Set<Template>> parser=i.getInstance(Key.get(new TypeLiteral<UnwrapOnlyNestedJsonValue<Set<Template>>>(){
  }
));
  Set<Template> response=parser.apply(new HttpResponse(200,"ok",Payloads.newInputStreamPayload(is)));
  assertEquals(Sets.newTreeSet(response),expects);
}
