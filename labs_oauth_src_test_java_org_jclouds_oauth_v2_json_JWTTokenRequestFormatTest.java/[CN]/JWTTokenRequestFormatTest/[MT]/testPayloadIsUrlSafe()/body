{
  TokenRequestFormat tokenRequestFormat=ContextBuilder.newBuilder(new OAuthApiMetadata()).overrides(OAuthTestUtils.defaultProperties(null)).build().utils().injector().getInstance(TokenRequestFormat.class);
  Header header=new Header.Builder().signerAlgorithm("a").type("b").build();
  ClaimSet claimSet=new ClaimSet.Builder().addClaim("ist",STRING_THAT_GENERATES_URL_UNSAFE_BASE64_ENCODING).build();
  TokenRequest tokenRequest=new TokenRequest.Builder().claimSet(claimSet).header(header).build();
  HttpRequest request=tokenRequestFormat.formatRequest(HttpRequest.builder().method("GET").endpoint("http://localhost").build(),tokenRequest);
  assertNotNull(request.getPayload());
  String payload=Strings2.toStringAndClose(request.getPayload().getInput());
  Iterable<String> parts=Splitter.on(".").split(payload);
  assertSame(Iterables.size(parts),3);
  assertTrue(!payload.contains("+"));
  assertTrue(!payload.contains("/"));
}
