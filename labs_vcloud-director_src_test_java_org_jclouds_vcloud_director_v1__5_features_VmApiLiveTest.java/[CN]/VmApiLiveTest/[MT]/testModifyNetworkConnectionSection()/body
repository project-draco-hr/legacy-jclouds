{
  Set<Reference> networks=vdc.getAvailableNetworks();
  Reference network=Iterables.getLast(networks);
  NetworkConnectionSection oldSection=vmApi.getNetworkConnectionSection(vm.getHref());
  NetworkConnectionSection newSection=oldSection.toBuilder().networkConnection(NetworkConnection.builder().ipAddressAllocationMode(IpAddressAllocationMode.DHCP.toString()).network(network.getName()).build()).build();
  Task modifyNetworkConnectionSection=vmApi.modifyNetworkConnectionSection(vm.getHref(),newSection);
  assertTrue(retryTaskSuccess.apply(modifyNetworkConnectionSection),String.format(TASK_COMPLETE_TIMELY,"modifyNetworkConnectionSection"));
  NetworkConnectionSection modified=vmApi.getNetworkConnectionSection(vm.getHref());
  checkNetworkConnectionSection(modified);
  assertEquals(modified.getNetworkConnections().size(),newSection.getNetworkConnections().size() + 1);
  assertEquals(modified,newSection,String.format(ENTITY_EQUAL,"NetworkConnectionSection"));
}
