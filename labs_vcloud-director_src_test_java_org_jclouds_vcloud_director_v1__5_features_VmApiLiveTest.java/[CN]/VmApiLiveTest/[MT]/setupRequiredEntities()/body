{
  Set<Link> links=vdcApi.get(vdcUrn).getLinks();
  if (mediaURI == null) {
    Predicate<Link> addMediaLink=and(relEquals(Link.Rel.ADD),typeEquals(VCloudDirectorMediaType.MEDIA));
    if (contains(links,addMediaLink)) {
      Link addMedia=find(links,addMediaLink);
      byte[] iso=new byte[]{0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15};
      Media sourceMedia=Media.builder().type(VCloudDirectorMediaType.MEDIA).name(name("media")).size(iso.length).imageType(Media.ImageType.ISO).description("Test media generated by VmApiLiveTest").build();
      Media media=context.getApi().getMediaApi().createMedia(addMedia.getHref(),sourceMedia);
      Link uploadLink=getFirst(getFirst(media.getFiles(),null).getLinks(),null);
      context.getApi().getUploadApi().upload(uploadLink.getHref(),Payloads.newByteArrayPayload(iso));
      media=context.getApi().getMediaApi().getMedia(media.getHref());
      if (media.getTasks().size() == 1) {
        Task uploadTask=Iterables.getOnlyElement(media.getTasks());
        Checks.checkTask(uploadTask);
        assertEquals(uploadTask.getStatus(),Task.Status.RUNNING);
        assertTrue(retryTaskSuccess.apply(uploadTask),String.format(TASK_COMPLETE_TIMELY,"uploadTask"));
        media=context.getApi().getMediaApi().getMedia(media.getHref());
      }
      mediaURI=media.getHref();
      mediaCreated=true;
    }
  }
  if (adminContext != null) {
    Link orgLink=find(links,and(relEquals("up"),typeEquals(VCloudDirectorMediaType.ORG)));
    userUrn=adminContext.getApi().getUserApi().createUserInOrg(randomTestUser("VAppAccessTest"),toAdminUri(orgLink)).getId();
  }
}
