{
  Set<Reference> networks=vdc.getAvailableNetworks();
  Reference network=Iterables.getLast(networks);
  NetworkConnectionSection oldSection=vmApi.getNetworkConnectionSection(vmUrn);
  NetworkConnection newNetworkConnection=NetworkConnection.builder().network(network.getName()).networkConnectionIndex(1).ipAddressAllocationMode(IpAddressAllocationMode.DHCP).build();
  NetworkConnectionSection newSection=oldSection.toBuilder().networkConnection(newNetworkConnection).build();
  Task editNetworkConnectionSection=vmApi.editNetworkConnectionSection(vmUrn,newSection);
  assertTrue(retryTaskSuccess.apply(editNetworkConnectionSection),String.format(TASK_COMPLETE_TIMELY,"editNetworkConnectionSection"));
  NetworkConnectionSection modified=vmApi.getNetworkConnectionSection(vmUrn);
  checkNetworkConnectionSection(modified);
  for (  NetworkConnection connection : modified.getNetworkConnections()) {
    if (connection.getNetwork().equals(newNetworkConnection.getNetwork())) {
      assertEquals(connection.getIpAddressAllocationMode(),newNetworkConnection.getIpAddressAllocationMode());
      assertSame(connection.getNetworkConnectionIndex(),newNetworkConnection.getNetworkConnectionIndex());
    }
  }
}
