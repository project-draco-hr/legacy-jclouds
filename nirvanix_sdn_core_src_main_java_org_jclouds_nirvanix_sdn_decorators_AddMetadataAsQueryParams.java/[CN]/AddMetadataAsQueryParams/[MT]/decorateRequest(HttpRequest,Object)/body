{
  checkArgument(checkNotNull(input,"input") instanceof Multimap,"this decorator is only valid for Multimaps!");
  UriBuilder builder=UriBuilder.fromUri(request.getEndpoint());
  Multimap<String,String> userMetadata=(Multimap<String,String>)input;
  List<String> metadata=Lists.newArrayList();
  for (  Entry<String,String> entry : userMetadata.entries()) {
    metadata.add(String.format("%s:%s",entry.getKey().toLowerCase(),entry.getValue()));
  }
  builder.replaceQueryParam("metadata",metadata.toArray());
  List<HttpRequestFilter> oldFilters=request.getFilters();
  request=new HttpRequest(request.getMethod(),builder.build(),request.getHeaders(),request.getEntity());
  request.getFilters().addAll(oldFilters);
  return request;
}
