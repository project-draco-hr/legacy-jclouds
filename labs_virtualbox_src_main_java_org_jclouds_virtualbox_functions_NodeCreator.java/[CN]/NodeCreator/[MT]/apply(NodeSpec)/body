{
  Master master=nodeSpec.getMaster();
  if (master.getMachine().getCurrentSnapshot() != null) {
    ISession session;
    try {
      session=manager.get().openMachineSession(master.getMachine());
    }
 catch (    Exception e) {
      throw new RuntimeException("error opening vbox machine session: " + e.getMessage(),e);
    }
    session.getConsole().deleteSnapshot(master.getMachine().getCurrentSnapshot().getId());
    session.unlockMachine();
  }
  String masterNameWithoutPrefix=master.getSpec().getVmSpec().getVmName().replace(VIRTUALBOX_IMAGE_PREFIX,"");
  String cloneName=VIRTUALBOX_NODE_PREFIX + masterNameWithoutPrefix + "-"+ nodeSpec.getTag()+ "-"+ nodeSpec.getName();
  VmSpec cloneVmSpec=VmSpec.builder().id(cloneName).name(cloneName).memoryMB(512).cleanUpMode(CleanupMode.Full).forceOverwrite(true).build();
  NetworkAdapter networkAdapter=NetworkAdapter.builder().networkAttachmentType(NetworkAttachmentType.NAT).tcpRedirectRule("127.0.0.1",2222,"",22).build();
  NetworkInterfaceCard networkInterfaceCard=NetworkInterfaceCard.builder().addNetworkAdapter(networkAdapter).build();
  NetworkSpec networkSpec=NetworkSpec.builder().addNIC(0L,networkInterfaceCard).build();
  CloneSpec cloneSpec=CloneSpec.builder().linked(false).master(master.getMachine()).network(networkSpec).vm(cloneVmSpec).build();
  IMachine cloned=cloner.apply(cloneSpec);
  new LaunchMachineIfNotAlreadyRunning(manager.get(),ExecutionType.GUI,"").apply(cloned);
  NodeAndInitialCredentials<IMachine> nodeAndInitialCredentials=new NodeAndInitialCredentials<IMachine>(cloned,cloneName,LoginCredentials.builder().user("toor").password("password").authenticateSudo(true).build());
  return nodeAndInitialCredentials;
}
