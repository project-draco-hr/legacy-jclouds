{
  String id=checkNotNull(instance,"instance").getId();
  String name=null;
  URI uri=null;
  String tag=getTagForInstace(instance);
  Credentials credentials=getCredentialsForInstanceWithTag(instance,tag);
  Map<String,String> userMetadata=ImmutableMap.<String,String>of();
  NodeState state=instanceToNodeState.get(instance.getInstanceState());
  Set<InetAddress> publicAddresses=nullSafeSet(instance.getIpAddress());
  Set<InetAddress> privateAddresses=nullSafeSet(instance.getPrivateIpAddress());
  Map<String,String> extra=getExtra(instance);
  Location location=getLocationForAvailabilityZone(instance);
  Image image=resolveImageForInstanceInLocation(instance,location);
  return new NodeMetadataImpl(id,name,instance.getRegion() + "/" + instance.getId(),location,uri,userMetadata,tag,image,state,publicAddresses,privateAddresses,extra,credentials);
}
