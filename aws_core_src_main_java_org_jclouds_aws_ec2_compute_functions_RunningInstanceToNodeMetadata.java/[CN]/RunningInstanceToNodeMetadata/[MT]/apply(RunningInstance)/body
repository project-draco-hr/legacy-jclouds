{
  String id=checkNotNull(instance,"instance").getId();
  String name=null;
  URI uri=null;
  Map<String,String> userMetadata=ImmutableMap.<String,String>of();
  String tag=instance.getKeyName().replaceAll("-[0-9]+","");
  NodeState state=instanceToNodeState.get(instance.getInstanceState());
  Set<InetAddress> publicAddresses=nullSafeSet(instance.getIpAddress());
  Set<InetAddress> privateAddresses=nullSafeSet(instance.getPrivateIpAddress());
  Credentials credentials=new Credentials(getLoginAccountFor(instance),getPrivateKeyOrNull(instance,tag));
  String locationId=instance.getAvailabilityZone().toString();
  Map<String,String> extra=ImmutableMap.<String,String>of();
  return new NodeMetadataImpl(id,name,locationId,uri,userMetadata,tag,state,publicAddresses,privateAddresses,extra,credentials);
}
