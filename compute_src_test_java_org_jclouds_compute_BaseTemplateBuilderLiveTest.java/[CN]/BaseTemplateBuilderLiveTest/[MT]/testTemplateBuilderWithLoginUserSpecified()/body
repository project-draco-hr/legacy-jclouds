{
  ComputeServiceContext context=null;
  try {
    Properties overrides=setupProperties();
    String login=loginUser != null ? loginUser : "foo:bar";
    overrides.setProperty("jclouds.login-user",login);
    context=new ComputeServiceContextFactory().createContext(provider,ImmutableSet.<Module>of(new Log4JLoggingModule()),overrides);
    Iterable<String> userPass=Splitter.on(':').split(login);
    String user=Iterables.get(userPass,0);
    String pass=Iterables.get(userPass,1);
    assertEquals(context.getComputeService().templateBuilder().build().getImage().getDefaultCredentials(),new Credentials(user,pass));
  }
  finally {
    if (context != null)     context.close();
  }
  context=null;
  try {
    Properties overrides=setupProperties();
    overrides.setProperty(provider + ".login-user","foo:bar");
    context=new ComputeServiceContextFactory().createContext(provider,ImmutableSet.<Module>of(new Log4JLoggingModule()),overrides);
    assertEquals(context.getComputeService().templateBuilder().build().getImage().getDefaultCredentials(),new Credentials("foo","bar"));
  }
  finally {
    if (context != null)     context.close();
  }
}
