{
  VAppApi vAppApi=context.getApi().getVAppApi();
  VApp vApp=vAppApi.getVApp(vAppURI);
  if (vApp == null) {
    logger.info("Cannot find VApp at %s",vAppURI.getPath());
    return;
  }
  logger.debug("Deleting VApp %s (%s)",vApp.getName(),vAppURI.getPath());
  if (vApp.getTasks() != null) {
    for (    Task task : vApp.getTasks()) {
      if (!taskDoneEventually(task)) {
        logger.warn("Task '%s' did not complete",task.getOperationName());
      }
    }
  }
  if (vApp.getStatus() == Status.POWERED_ON) {
    try {
      Task shutdownTask=vAppApi.shutdown(vAppURI);
      taskDoneEventually(shutdownTask);
    }
 catch (    Exception e) {
      logger.warn(e,"Continuing cleanup after error shutting down VApp %s",vApp.getName());
    }
  }
  if (vApp.isDeployed()) {
    try {
      UndeployVAppParams params=UndeployVAppParams.builder().undeployPowerAction(UndeployVAppParams.PowerAction.SHUTDOWN).build();
      Task undeployTask=vAppApi.undeploy(vAppURI,params);
      taskDoneEventually(undeployTask);
    }
 catch (    Exception e) {
      logger.warn(e,"Continuing cleanup after error undeploying VApp %s",vApp.getName());
    }
  }
  try {
    Task task=vAppApi.deleteVApp(vAppURI);
    taskDoneEventually(task);
    vAppNames.remove(vApp.getName());
    logger.info("Deleted VApp %s",vApp.getName());
  }
 catch (  Exception e) {
    vApp=vAppApi.getVApp(vAppURI);
    logger.warn(e,"Deleting VApp %s failed (%s)",vApp.getName(),vAppURI.getPath());
  }
}
