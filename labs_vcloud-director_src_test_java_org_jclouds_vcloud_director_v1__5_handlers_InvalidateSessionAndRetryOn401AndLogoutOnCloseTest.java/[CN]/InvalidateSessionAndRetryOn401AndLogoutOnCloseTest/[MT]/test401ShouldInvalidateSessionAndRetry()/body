{
  HttpCommand command=createMock(HttpCommand.class);
  SessionApi sessionApi=createMock(SessionApi.class);
  LoadingCache<Credentials,SessionWithToken> cache=createMock(LoadingCache.class);
  cache.invalidateAll();
  expectLastCall();
  expect(command.incrementFailureCount()).andReturn(1);
  expect(command.isReplayable()).andReturn(true);
  expect(command.getFailureCount()).andReturn(1).atLeastOnce();
  replay(cache,command);
  HttpResponse response=HttpResponse.builder().statusCode(401).build();
  InvalidateSessionAndRetryOn401AndLogoutOnClose retry=new InvalidateSessionAndRetryOn401AndLogoutOnClose(cache,sessionApi);
  assertTrue(retry.shouldRetryRequest(command,response));
  verify(cache,command);
}
