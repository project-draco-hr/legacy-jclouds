{
  String shortClassName=bean.getClassName().substring(bean.getClassName().lastIndexOf('.') + 1);
  Map<String,Object> objectMap=new HashMap<String,Object>();
  objectMap.put("bean",bean);
  objectMap.put("rootPackageName",this.rootPackageName);
  objectMap.put("shortClassName",shortClassName);
  File packageDir=new File(this.targetDirectory,bean.getPackageName().replace('.','/'));
  if (packageDir.exists() || packageDir.mkdirs()) {
    File javaFile=new File(packageDir,shortClassName + ".java");
    FileWriter fw=new FileWriter(javaFile);
    System.out.println("Generated " + javaFile);
    applyTemplate(templateFileName,objectMap,fw);
  }
 else {
    throw new IllegalStateException("Unable to create target package directory: " + packageDir);
  }
}
