{
  Credentials currentCreds=checkNotNull(creds.get(),"credential supplier returned null");
  String keyStorePassword=checkNotNull(currentCreds.credential,"credential supplier returned null credential (should be keyStorePassword)");
  KeyManagerFactory kmf;
  try {
    kmf=KeyManagerFactory.getInstance("SunX509");
    kmf.init(keyStore.get(),keyStorePassword.toCharArray());
    SSLContext sc=SSLContext.getInstance("TLS");
    sc.init(kmf.getKeyManagers(),trustManager,new SecureRandom());
    return sc;
  }
 catch (  NoSuchAlgorithmException e) {
    throw propagate(e);
  }
catch (  UnrecoverableKeyException e) {
    throw propagate(e);
  }
catch (  KeyStoreException e) {
    throw propagate(e);
  }
catch (  KeyManagementException e) {
    throw propagate(e);
  }
}
