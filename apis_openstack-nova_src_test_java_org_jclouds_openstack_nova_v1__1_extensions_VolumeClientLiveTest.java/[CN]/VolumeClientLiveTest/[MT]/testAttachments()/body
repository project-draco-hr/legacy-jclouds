{
  if (client != null) {
    Set<Resource> servers=novaContext.getApi().getServerClientForZone(zone).listServers();
    if (!servers.isEmpty()) {
      final String serverId=Iterables.getFirst(servers,null).getId();
      Set<VolumeAttachment> attachments=client.listAttachments(serverId);
      assertNotNull(attachments);
      final int before=attachments.size();
      VolumeAttachment testAttachment=client.attachVolume(serverId,testVolume.getId(),"/dev/vdf");
      assertNotNull(testAttachment.getId());
      assertEquals(testAttachment.getVolumeId(),testVolume.getId());
      assertTrue(new RetryablePredicate<VolumeClient>(new Predicate<VolumeClient>(){
        @Override public boolean apply(        VolumeClient volumeClient){
          return client.listAttachments(serverId).size() == before + 1;
        }
      }
,60 * 1000L).apply(client));
      attachments=client.listAttachments(serverId);
      assertNotNull(attachments);
      assertEquals(attachments.size(),before + 1);
      assertEquals(client.getVolume(testVolume.getId()).getStatus(),Volume.Status.IN_USE);
      boolean foundIt=false;
      for (      VolumeAttachment att : attachments) {
        VolumeAttachment details=client.getAttachment(serverId,att.getId());
        assertNotNull(details);
        assertNotNull(details.getId());
        assertNotNull(details.getServerId());
        assertNotNull(details.getVolumeId());
        if (Objects.equal(details.getVolumeId(),testVolume.getId())) {
          foundIt=true;
          assertEquals(details.getDevice(),"/dev/vdf");
          assertEquals(details.getServerId(),serverId);
        }
      }
      assertTrue(foundIt,"Failed to find the attachment we created in listAttachments() response");
      client.detachVolume(serverId,testVolume.getId());
      assertTrue(new RetryablePredicate<VolumeClient>(new Predicate<VolumeClient>(){
        @Override public boolean apply(        VolumeClient volumeClient){
          return client.listAttachments(serverId).size() == before;
        }
      }
,60 * 1000L).apply(client));
    }
  }
}
