{
  RetryablePredicate retryablePredicate=new RetryablePredicate(taskFinished(),1000 * 60);
  if (!retryablePredicate.apply(client.shutdown(vm.getHref()))) {
    fail("Did not manage to finish shutdown task");
  }
  retryablePredicate=new RetryablePredicate(poweredOff(),1000 * 60);
  if (!retryablePredicate.apply(vm.getHref())) {
    fail("Did not manage to powerOff after shutdown");
  }
  vm=client.getVirtualMachine(vm.getHref());
  assertFalse(vm.isPoweredOn());
}
