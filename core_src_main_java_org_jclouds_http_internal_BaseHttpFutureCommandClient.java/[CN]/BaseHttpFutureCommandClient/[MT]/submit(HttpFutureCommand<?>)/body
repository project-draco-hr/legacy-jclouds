{
  HttpRequest request=command.getRequest();
  try {
    HttpResponse response=null;
    for (; ; ) {
      Q nativeRequest=null;
      try {
        logger.trace("%s - converting request %s",request.getEndPoint(),request);
        for (        HttpRequestFilter filter : requestFilters) {
          filter.filter(request);
        }
        nativeRequest=convert(request);
        response=invoke(nativeRequest);
        int statusCode=response.getStatusCode();
        if (statusCode >= 300) {
          if (retryHandler.shouldRetryRequest(command,response)) {
            continue;
          }
 else {
            errorHandler.handleError(command,response);
            break;
          }
        }
 else {
          processResponse(response,command);
          break;
        }
      }
  finally {
        cleanup(nativeRequest);
      }
    }
  }
 catch (  Exception e) {
    command.setException(new ExecutionException(String.format("error invoking request %s",request),e));
  }
}
