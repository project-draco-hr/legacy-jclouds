{
  NovaClient client=createMock(NovaClient.class);
  FloatingIPClient ipClient=createMock(FloatingIPClient.class);
  expect(client.getConfiguredRegions()).andReturn(ImmutableSet.of("region")).atLeastOnce();
  expect(client.getFloatingIPExtensionForRegion("region")).andReturn(Optional.of(ipClient)).atLeastOnce();
  expect(ipClient.listFloatingIPs()).andReturn(ImmutableSet.<FloatingIP>of(FloatingIP.builder().id("1").ip("1.1.1.1").build())).atLeastOnce();
  replay(client);
  replay(ipClient);
  LoadFloatingIpsForInstance parser=new LoadFloatingIpsForInstance(client);
  assertFalse(parser.load(new RegionAndName("region","i-blah")).iterator().hasNext());
  verify(client);
  verify(ipClient);
}
