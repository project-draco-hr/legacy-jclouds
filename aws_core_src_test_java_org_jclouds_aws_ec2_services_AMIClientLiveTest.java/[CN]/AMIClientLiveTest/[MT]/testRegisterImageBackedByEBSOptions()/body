{
  String imageRegisteredWithOptionsId=client.registerImageBackedByEbsInRegion(Region.DEFAULT,"jcloudstest2",DEFAULT_SNAPSHOT,addNewBlockDevice("/dev/sda2","myvirtual",1).withDescription("adrian"));
  imagesToDeregister.add(imageRegisteredWithOptionsId);
  Image imageRegisteredWithOptions=Iterables.getOnlyElement(client.describeImagesInRegion(Region.DEFAULT,imageIds(imageRegisteredWithOptionsId)));
  assertEquals(imageRegisteredWithOptions.getName(),"jcloudstest2");
  assertEquals(imageRegisteredWithOptions.getImageType(),ImageType.MACHINE);
  assertEquals(imageRegisteredWithOptions.getRootDeviceType(),RootDeviceType.EBS);
  assertEquals(imageRegisteredWithOptions.getRootDeviceName(),"/dev/sda1");
  assertEquals(imageRegisteredWithOptions.getDescription(),"adrian");
  assertEquals(imageRegisteredWithOptions.getEbsBlockDevices().entrySet(),ImmutableMap.of("/dev/sda1",new Image.EbsBlockDevice("/dev/sda1",30,true),"/dev/sda2",new Image.EbsBlockDevice("/dev/sda2",1,true)).entrySet());
}
