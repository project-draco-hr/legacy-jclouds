{
  HttpResponse response=null;
  for (; ; ) {
    HttpRequest request=command.getRequest();
    Q nativeRequest=null;
    try {
      for (      HttpRequestFilter filter : request.getFilters()) {
        filter.filter(request);
      }
      logger.debug("Sending request %s: %s",request.hashCode(),request.getRequestLine());
      if (request.getEntity() != null && wire.enabled())       request.setEntity(wire.output(request.getEntity()));
      nativeRequest=convert(request);
      HttpUtils.logRequest(headerLog,request,">>");
      response=invoke(nativeRequest);
      logger.debug("Receiving response %s: %s",request.hashCode(),response.getStatusLine());
      HttpUtils.logResponse(headerLog,response,"<<");
      if (response.getContent() != null && wire.enabled())       response.setContent(wire.input(response.getContent()));
      int statusCode=response.getStatusCode();
      if (statusCode >= 300) {
        if (retryHandler.shouldRetryRequest(command,response)) {
          continue;
        }
 else {
          errorHandler.handleError(command,response);
          break;
        }
      }
 else {
        break;
      }
    }
  finally {
      cleanup(nativeRequest);
    }
  }
  if (command.getException() != null)   throw command.getException();
  return response;
}
