{
  Exception exception=null;
  String defaultMessage=String.format("%s -> %s",command.getCurrentRequest().getRequestLine(),response.getStatusLine());
  try {
switch (response.getStatusCode()) {
case 401:
case 403:
      exception=new AuthorizationException(defaultMessage,new HttpResponseException(command,response,defaultMessage));
    break;
case 404:
  exception=new ResourceNotFoundException(defaultMessage,getExceptionToPropagate(command,response,defaultMessage));
break;
case 301:
exception=new HttpResponseException(command,response,defaultMessage);
break;
default :
exception=getExceptionToPropagate(command,response,defaultMessage);
break;
}
}
  finally {
Closeables.closeQuietly(response.getPayload());
command.setException(exception);
}
}
