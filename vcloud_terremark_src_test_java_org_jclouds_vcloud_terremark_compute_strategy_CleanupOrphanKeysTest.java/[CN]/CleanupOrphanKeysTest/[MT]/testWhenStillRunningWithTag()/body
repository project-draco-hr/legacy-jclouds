{
  CleanupOrphanKeys strategy=setupStrategy();
  NodeMetadata nodeMetadata=createMock(NodeMetadata.class);
  Iterable<? extends NodeMetadata> deadOnes=ImmutableSet.<NodeMetadata>of(nodeMetadata);
  OrgAndName orgTag=new OrgAndName("location","tag");
  expect(strategy.nodeToOrgAndName.apply(nodeMetadata)).andReturn(orgTag).atLeastOnce();
  expect((Object)strategy.listNodes.listDetailsOnNodesMatching(parentLocationId(orgTag.getOrg()))).andReturn(ImmutableSet.of(nodeMetadata));
  expect(nodeMetadata.getTag()).andReturn(orgTag.getName()).atLeastOnce();
  expect(nodeMetadata.getState()).andReturn(NodeState.RUNNING).atLeastOnce();
  replay(nodeMetadata);
  replayStrategy(strategy);
  strategy.execute(deadOnes);
  verify(nodeMetadata);
  verifyStrategy(strategy);
}
