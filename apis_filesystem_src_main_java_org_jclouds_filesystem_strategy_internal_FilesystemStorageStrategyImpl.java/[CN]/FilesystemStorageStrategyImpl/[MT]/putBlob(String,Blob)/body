{
  String blobKey=blob.getMetadata().getName();
  Payload payload=blob.getPayload();
  filesystemContainerNameValidator.validate(containerName);
  filesystemBlobKeyValidator.validate(blobKey);
  File outputFile=getFileForBlobKey(containerName,blobKey);
  FileOutputStream output=null;
  try {
    Files.createParentDirs(outputFile);
    if (payload.getRawContent() instanceof File)     Files.copy((File)payload.getRawContent(),outputFile);
 else {
      output=new FileOutputStream(outputFile);
      payload.writeTo(output);
    }
    Payloads.calculateMD5(payload,crypto.md5());
    String eTag=CryptoStreams.hex(payload.getContentMetadata().getContentMD5());
    return eTag;
  }
 catch (  IOException ex) {
    if (outputFile != null) {
      outputFile.delete();
    }
    throw ex;
  }
 finally {
    Closeables.closeQuietly(output);
    payload.release();
  }
}
