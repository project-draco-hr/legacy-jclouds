{
  try {
    logger.debug("starting initialization");
    Properties overrides=InitParamsToProperties.INSTANCE.apply(servletContextEvent.getServletContext());
    logger.trace("creating client connection");
    ChefService client=createService(overrides,servletContextEvent);
    logger.debug("created client connection");
    Node node;
    String nodeName;
    while (true) {
      nodeName=findNextNodeName(client,getInitParam(servletContextEvent,CHEF_NODE_PATTERN));
      try {
        node=client.createNodeAndPopulateAutomaticAttributes(nodeName,Splitter.on(',').split(getInitParam(servletContextEvent,CHEF_RUN_LIST)));
        break;
      }
 catch (      IllegalStateException ex) {
        logger.debug("client already exists %s: %s",nodeName,ex.getMessage());
      }
    }
    servletContextEvent.getServletContext().setAttribute(CHEF_NODE,node);
    servletContextEvent.getServletContext().setAttribute(CHEF_SERVICE_CLIENT,client);
    logger.debug("initialized");
  }
 catch (  RuntimeException e) {
    logger.error(e,"error registering");
    throw e;
  }
}
