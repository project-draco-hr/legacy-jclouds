{
  VCloudDirectorUserClient client=requestsSendResponses(loginRequest,sessionResponse,new VcloudHttpRequestPrimer().apiCommand("POST","/vdc/e9cd3387-ac57-4d27-a481-9bee75e0690f/action/captureVApp").xmlFilePayload("/vdc/params/captureVApp.xml",VCloudDirectorMediaType.CAPTURE_VAPP_PARAMS).acceptAnyMedia().httpRequestBuilder().build(),new VcloudHttpResponsePrimer().xmlFilePayload("/vdc/param/error400.xml",VCloudDirectorMediaType.ERROR).httpResponseBuilder().statusCode(400).build());
  Error expected=Error.builder().message("?").majorErrorCode(400).minorErrorCode("BAD_REQUEST").build();
  try {
    client.getVdcClient().captureVApp(vdcURI,null);
    fail("Should give HTTP 400 error");
  }
 catch (  VCloudDirectorException vde) {
    assertEquals(vde.getError(),expected);
  }
}
