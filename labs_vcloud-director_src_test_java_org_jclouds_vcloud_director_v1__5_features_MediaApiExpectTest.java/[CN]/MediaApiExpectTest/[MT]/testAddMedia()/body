{
  URI uploadLink=URI.create(endpoint + "/vdc/e9cd3387-ac57-4d27-a481-9bee75e0690f/media");
  VCloudDirectorApi api=requestsSendResponses(loginRequest,sessionResponse,new VcloudHttpRequestPrimer().apiCommand("POST","/vdc/e9cd3387-ac57-4d27-a481-9bee75e0690f/media").acceptMedia(VCloudDirectorMediaType.MEDIA).xmlFilePayload("/media/addMediaSource.xml",VCloudDirectorMediaType.MEDIA).httpRequestBuilder().build(),new VcloudHttpResponsePrimer().xmlFilePayload("/media/addMedia.xml",VCloudDirectorMediaType.MEDIA).httpResponseBuilder().statusCode(201).build());
  Media source=Media.builder().size(0).imageType(ImageType.ISO).name("Test media 1").type("application/vnd.vmware.vcloud.media+xml").description("Test media generated by testCreateMedia()").build();
  Media expected=addMedia();
  assertEquals(api.getMediaApi().add(uploadLink,source),expected);
}
