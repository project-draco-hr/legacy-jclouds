{
  URI mediaUri=URI.create("https://vcloudbeta.bluelock.com/api/media/794eb334-754e-4917-b5a0-5df85cbd61d1");
  URI setMetadataUri=URI.create(mediaUri.toASCIIString() + "/metadata/key");
  VCloudDirectorClient client=requestsSendResponses(loginRequest,sessionResponse,getStandardPayloadRequest("PUT",setMetadataUri,VCloudDirectorMediaType.TASK,"/media/setMetadata.xml",VCloudDirectorMediaType.METADATA_VALUE),getStandardPayloadResponse("/media/setMetadataTask.xml",VCloudDirectorMediaType.TASK));
  Reference mediaRef=Reference.builder().href(mediaUri).build();
  MetadataValue inputMetadataValue=MetadataValue.builder().value("value").build();
  Task expectedTask=Task.builder().status("running").startTime(dateService.iso8601DateParse("2012-02-13T06:35:08.011-05:00")).operationName("metadataSet").operation("Setting metadata for Media (794eb334-754e-4917-b5a0-5df85cbd61d1)").expiryTime(dateService.iso8601DateParse("2012-05-13T06:35:08.011-04:00")).name("Task").id("urn:vcloud:task:c6dca927-eab4-41fa-ad6a-3ac58602541c").type("application/vnd.vmware.vcloud.task+xml").href(URI.create("https://vcloudbeta.bluelock.com/api/task/c6dca927-eab4-41fa-ad6a-3ac58602541c")).link(Link.builder().rel("task:cancel").href(URI.create("https://vcloudbeta.bluelock.com/api/task/c6dca927-eab4-41fa-ad6a-3ac58602541c/action/cancel")).build()).owner(Reference.builder().type("application/vnd.vmware.vcloud.media+xml").name("").href(URI.create("https://vcloudbeta.bluelock.com/api/media/794eb334-754e-4917-b5a0-5df85cbd61d1")).build()).user(Reference.builder().type("application/vnd.vmware.admin.user+xml").name("adk@cloudsoftcorp.com").href(URI.create("https://vcloudbeta.bluelock.com/api/admin/user/e9eb1b29-0404-4c5e-8ef7-e584acc51da9")).build()).org(Reference.builder().type("application/vnd.vmware.vcloud.org+xml").name("JClouds").href(URI.create("https://vcloudbeta.bluelock.com/api/org/6f312e42-cd2b-488d-a2bb-97519cd57ed0")).build()).build();
  assertEquals(client.getMediaClient().setMetadata(mediaRef,"key",inputMetadataValue),expectedTask);
}
