{
  URI mediaUri=URI.create("https://vcloudbeta.bluelock.com/api/media/794eb334-754e-4917-b5a0-5df85cbd61d1");
  VCloudDirectorClient client=requestsSendResponses(loginRequest,sessionResponse,new VcloudHttpRequestPrimer().apiCommand("POST","/media/794eb334-754e-4917-b5a0-5df85cbd61d1/metadata").xmlFilePayload("/media/metadata.xml",VCloudDirectorMediaType.METADATA).acceptMedia(VCloudDirectorMediaType.TASK).httpRequestBuilder().build(),new VcloudHttpResponsePrimer().xmlFilePayload("/media/mergeMetadataTask.xml",VCloudDirectorMediaType.TASK).httpResponseBuilder().build());
  Reference mediaRef=Reference.builder().href(mediaUri).build();
  Metadata inputMetadata=metadata();
  Task expectedTask=Task.builder().build();
  assertEquals(client.getMediaClient().mergeMetadata(mediaRef,inputMetadata),expectedTask);
}
