{
  if (response.getFirstHeaderOrNull(HttpHeaders.LOCATION) == null && (response.getStatusCode() == 301 || response.getStatusCode() == 307)) {
    if (command.getRequest().getMethod() == HttpMethod.HEAD) {
      changeToGETRequest(command.getRequest());
      return true;
    }
 else {
      command.incrementRedirectCount();
      closeClientButKeepContentStream(response);
      AWSError error=utils.parseAWSErrorFromContent(command.getRequest(),response);
      String host=error.getDetails().get("Endpoint");
      if (host != null) {
        if (host.equals(command.getRequest().getEndpoint().getHost())) {
          return backoffHandler.shouldRetryRequest(command,response);
        }
 else {
          changeSchemeHostAndPortTo(command.getRequest(),command.getRequest().getEndpoint().getScheme(),host,command.getRequest().getEndpoint().getPort(),uriBuilderProvider.get());
        }
        return true;
      }
 else {
        return false;
      }
    }
  }
 else {
    return super.shouldRetryRequest(command,response);
  }
}
