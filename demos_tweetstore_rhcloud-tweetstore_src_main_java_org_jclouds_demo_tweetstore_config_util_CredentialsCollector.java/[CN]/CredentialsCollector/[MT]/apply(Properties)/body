{
  Collection<String> providerNames=transform(filter(properties.stringPropertyNames(),MatchesPattern.matches(IDENTITY_PROPERTY_PATTERN)),new Function<String,String>(){
    @Override public String apply(    String input){
      Matcher matcher=IDENTITY_PROPERTY_PATTERN.matcher(input);
      checkState(matcher.matches(),"'%s' should match '%s'",input,IDENTITY_PROPERTY_PATTERN);
      return matcher.group(1);
    }
  }
);
  return filterValues(fromKeys(copyOf(providerNames),new Function<String,Credential>(){
    @Override public Credential apply(    String providerName){
      String identity=properties.getProperty(providerName + IDENTITY_PROPERTY_SUFFIX);
      String credential=properties.getProperty(providerName + CREDENTIAL_PROPERTY_SUFFIX);
      return (((identity != null) && (credential != null)) ? new Credential(identity,credential) : null);
    }
  }
),notNull());
}
