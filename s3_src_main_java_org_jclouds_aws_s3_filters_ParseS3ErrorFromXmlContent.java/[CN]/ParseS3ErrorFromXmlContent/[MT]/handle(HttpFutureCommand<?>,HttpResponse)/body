{
  S3Error error=new S3Error();
  error.setRequestId(response.getFirstHeaderOrNull(S3Headers.REQUEST_ID));
  error.setRequestToken(response.getFirstHeaderOrNull(S3Headers.REQUEST_TOKEN));
  InputStream errorStream=response.getContent();
  try {
    if (errorStream != null) {
      error=parserFactory.createErrorParser().parse(errorStream);
      if ("SignatureDoesNotMatch".equals(error.getCode()))       error.setStringSigned(RequestAuthorizeSignature.createStringToSign(command.getRequest()));
      error.setRequestToken(response.getFirstHeaderOrNull(S3Headers.REQUEST_TOKEN));
    }
  }
 catch (  Exception e) {
    logger.warn(e,"error parsing XML reponse: %1$s",response);
  }
 finally {
    command.setException(new S3ResponseException(command,response,error));
    IOUtils.closeQuietly(errorStream);
  }
}
