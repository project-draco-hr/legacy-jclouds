{
  ElasticLoadBalancerClient elbClient=EC2Client.class.cast(context.getProviderSpecificContext().getApi()).getElasticLoadBalancerServices();
  String tag="jcloudsElbTest";
  Template template=client.templateBuilder().build();
  try {
    Set<? extends NodeMetadata> nodes=client.runNodesWithTag(tag,2,template);
    Set<String> instanceIds=new HashSet<String>();
    for (    NodeMetadata node : nodes) {
      instanceIds.add(node.getProviderId());
    }
    Set<String> dnsNames=client.loadBalanceNodesMatching(NodePredicates.withTag(tag),tag,"HTTP",80,80);
    assertNotNull(dnsNames);
    Set<ElasticLoadBalancer> elbs=elbClient.describeLoadBalancersInRegion(Region.US_EAST_1,tag);
    assertNotNull(elbs);
    ElasticLoadBalancer elb=elbs.iterator().next();
    assertEquals(elb.getInstanceIds(),instanceIds);
  }
  finally {
    elbClient.deleteLoadBalancerInRegion(Region.US_EAST_1,tag);
    client.destroyNodesMatching(NodePredicates.withTag(tag));
  }
}
