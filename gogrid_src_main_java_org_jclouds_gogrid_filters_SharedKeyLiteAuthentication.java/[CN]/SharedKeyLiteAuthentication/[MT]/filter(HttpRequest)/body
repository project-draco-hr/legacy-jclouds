{
  checkArgument(checkNotNull(request,"input") instanceof GeneratedHttpRequest<?>,"this decorator is only valid for GeneratedHttpRequests!");
  String toSign=createStringToSign();
  String signatureMd5=getMd5For(toSign);
  String query=request.getEndpoint().getQuery();
  Multimap<String,String> decodedParams=RestAnnotationProcessor.parseQueryToMap(query);
  decodedParams.replaceValues("sig",ImmutableSet.of(signatureMd5));
  decodedParams.replaceValues("api_key",ImmutableSet.of(apiKey));
  String updatedQuery=RestAnnotationProcessor.makeQueryLine(decodedParams,null);
  String requestBasePart=request.getEndpoint().toASCIIString();
  String updatedEndpoint=requestBasePart.substring(0,requestBasePart.indexOf("?") + 1) + updatedQuery;
  request.setEndpoint(URI.create(updatedEndpoint));
  HttpUtils.logRequest(signatureLog,request,"<<");
}
