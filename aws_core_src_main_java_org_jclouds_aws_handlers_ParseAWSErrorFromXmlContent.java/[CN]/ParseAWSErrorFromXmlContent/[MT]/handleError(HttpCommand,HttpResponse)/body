{
  Exception exception=null;
  try {
switch (response.getStatusCode()) {
case 401:
      exception=new AuthorizationException(command.getRequest().getRequestLine());
    break;
case 404:
  String container=command.getRequest().getEndpoint().getHost();
String key=command.getRequest().getEndpoint().getPath();
if (key == null || key.equals("/")) exception=new ContainerNotFoundException(container);
 else exception=new KeyNotFoundException(container,key);
break;
default :
if (response.getContent() != null) {
try {
String content=Utils.toStringAndClose(response.getContent());
if (content.indexOf('<') >= 0) {
AWSError error=utils.parseAWSErrorFromContent(command,response,content);
exception=new AWSResponseException(command,response,error);
if (error.getCode().indexOf("NotFound") >= 0) exception=new ResourceNotFoundException(exception);
}
 else {
exception=new HttpResponseException(command,response,content);
}
}
 catch (IOException e) {
logger.warn(e,"exception reading error from response",response);
}
}
}
}
  finally {
Closeables.closeQuietly(response.getContent());
command.setException(exception);
}
}
