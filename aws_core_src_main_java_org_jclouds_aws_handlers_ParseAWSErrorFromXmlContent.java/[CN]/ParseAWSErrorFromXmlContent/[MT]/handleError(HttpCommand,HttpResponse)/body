{
  Exception exception=new HttpResponseException(command,response);
  try {
    AWSError error=parseErrorFromContentOrNull(command,response);
switch (response.getStatusCode()) {
case 401:
      exception=new AuthorizationException(command.getRequest(),error != null ? error.getMessage() : response.getStatusLine());
    break;
case 404:
  if (!command.getRequest().getMethod().equals("DELETE")) {
    String message=error != null ? error.getMessage() : String.format("%s -> %s",command.getRequest().getRequestLine(),response.getStatusLine());
    String container=command.getRequest().getEndpoint().getHost();
    String key=command.getRequest().getEndpoint().getPath();
    if (key == null || key.equals("/"))     exception=new ContainerNotFoundException(container,message);
 else     exception=new KeyNotFoundException(container,key,message);
  }
break;
default :
exception=error != null ? new AWSResponseException(command,response,error) : new HttpResponseException(command,response);
}
}
  finally {
Closeables.closeQuietly(response.getContent());
command.setException(exception);
}
}
