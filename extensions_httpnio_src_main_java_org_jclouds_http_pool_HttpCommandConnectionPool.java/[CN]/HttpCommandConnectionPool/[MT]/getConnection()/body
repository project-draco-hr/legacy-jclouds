{
  exceptionIfNotActive();
  if (!hitBottom) {
    hitBottom=available.size() == 0 && allConnections.availablePermits() == 0;
    if (hitBottom)     logger.warn("saturated connection pool");
  }
  logger.trace("Blocking up to %ds for a connection to %s",5,getEndPoint());
  C conn=available.poll(5,TimeUnit.SECONDS);
  if (conn == null)   throw new TimeoutException(String.format("Timeout after %ds for a connection to %s",5,getEndPoint()));
  if (connectionValid(conn)) {
    return conn;
  }
 else {
    logger.debug("Connection %s unusable for endpoint %s",conn.hashCode(),getEndPoint());
    shutdownConnection(conn);
    allConnections.release();
    return getConnection();
  }
}
