{
  @SuppressWarnings("unchecked") Map<String,Credentials> credstore=createMock(Map.class);
  Credentials credentials=createMock(Credentials.class);
  expect(credstore.put("node#id",credentials)).andReturn(null);
  replay(credstore);
  NodeMetadata node=new NodeMetadataBuilder().ids("id").state(NodeState.RUNNING).credentials(credentials).build();
  RefreshCredentialsForNode fn=new PersistNodeCredentialsModule.RefreshCredentialsForNode(credstore,null);
  assertEquals(node,fn.apply(node));
  verify(credstore);
}
