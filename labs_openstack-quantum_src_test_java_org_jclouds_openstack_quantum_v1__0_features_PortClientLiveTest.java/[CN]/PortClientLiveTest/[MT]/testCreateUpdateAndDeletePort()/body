{
  for (  String regionId : quantumContext.getApi().getConfiguredRegions()) {
    NetworkClient netClient=quantumContext.getApi().getNetworkClientForRegion(regionId);
    PortClient portClient=quantumContext.getApi().getPortClientForRegion(regionId);
    Reference net=netClient.create("jclouds-port-test");
    assertNotNull(net);
    Reference portRef=portClient.create(net.getId());
    assertNotNull(portRef);
    Port port=portClient.show(net.getId(),portRef.getId());
    PortDetails portDetails=portClient.showDetails(net.getId(),portRef.getId());
    NetworkDetails networkDetails=netClient.showDetails(net.getId());
    assertEquals(port.getState(),portDetails.getState());
    for (    Port checkme : ImmutableList.of(port,portDetails,Iterables.getOnlyElement(networkDetails.getPorts()))) {
      assertEquals(checkme.getId(),portRef.getId());
    }
    assertTrue(portClient.update(net.getId(),portRef.getId(),Port.State.DOWN));
    port=portClient.show(net.getId(),portRef.getId());
    portDetails=portClient.showDetails(net.getId(),portRef.getId());
    for (    Port checkme : ImmutableList.of(port,portDetails)) {
      assertEquals(checkme.getId(),portRef.getId());
      assertEquals(checkme.getState(),Port.State.DOWN);
    }
    assertTrue(portClient.plugAttachment(net.getId(),port.getId(),"jclouds-live-test"));
    Attachment attachment=portClient.showAttachment(net.getId(),port.getId());
    portDetails=portClient.showDetails(net.getId(),portRef.getId());
    for (    Attachment checkme : ImmutableList.of(attachment,portDetails.getAttachment())) {
      assertNotNull(checkme);
      assertEquals(checkme.getId(),"jclouds-live-test");
    }
    assertTrue(portClient.unplugAttachment(net.getId(),port.getId()));
    assertTrue(portClient.delete(net.getId(),portRef.getId()));
    assertTrue(netClient.delete(net.getId()));
  }
}
