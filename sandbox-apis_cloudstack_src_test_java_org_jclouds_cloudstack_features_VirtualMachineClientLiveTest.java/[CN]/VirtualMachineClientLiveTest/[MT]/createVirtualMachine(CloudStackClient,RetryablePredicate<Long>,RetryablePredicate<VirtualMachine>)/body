{
  Set<Network> networks=client.getNetworkClient().listNetworks();
  if (networks.size() > 0) {
    return createVirtualMachineInNetwork(get(networks,0),client,jobComplete,virtualMachineRunning);
  }
 else {
    return createVirtualMachineWithSecurityGroupInZone(find(client.getZoneClient().listZones(),new Predicate<Zone>(){
      @Override public boolean apply(      Zone arg0){
        return arg0.isSecurityGroupsEnabled();
      }
    }
).getId(),get(client.getSecurityGroupClient().listSecurityGroups(),0).getId(),client,jobComplete,virtualMachineRunning);
  }
}
