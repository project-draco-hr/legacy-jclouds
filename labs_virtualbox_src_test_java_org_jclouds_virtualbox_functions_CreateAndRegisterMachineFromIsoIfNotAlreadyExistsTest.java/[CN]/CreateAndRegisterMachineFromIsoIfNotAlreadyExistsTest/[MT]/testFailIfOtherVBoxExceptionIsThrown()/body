{
  MachineUtils machineUtils=createMock(MachineUtils.class);
  VirtualBoxManager manager=createNiceMock(VirtualBoxManager.class);
  IVirtualBox vBox=createNiceMock(IVirtualBox.class);
  String vmName="jclouds-image-my-ubuntu-image";
  String errorMessage="VirtualBox error: Some other VBox error";
  VBoxException vBoxException=new VBoxException(createNiceMock(Throwable.class),errorMessage);
  expect(manager.getVBox()).andReturn(vBox).anyTimes();
  vBox.findMachine(vmName);
  expectLastCall().andThrow(vBoxException);
  replay(manager,vBox,machineUtils);
  VmSpec launchSpecification=VmSpec.builder().id(vmName).name(vmName).osTypeId("").cleanUpMode(CleanupMode.Full).memoryMB(1024).build();
  MasterSpec machineSpec=MasterSpec.builder().iso(IsoSpec.builder().sourcePath("some.iso").installationScript("dostuff").build()).vm(launchSpecification).network(NetworkSpec.builder().build()).build();
  new CreateAndRegisterMachineFromIsoIfNotAlreadyExists(Suppliers.ofInstance(manager),machineUtils,"/tmp/workingDir").apply(machineSpec);
}
