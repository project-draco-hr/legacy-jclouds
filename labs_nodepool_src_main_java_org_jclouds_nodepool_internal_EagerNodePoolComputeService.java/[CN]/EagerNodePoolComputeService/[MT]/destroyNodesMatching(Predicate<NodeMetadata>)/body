{
  Set<Map.Entry<String,NodeMetadata>> poolNodesToUnassign=Sets.newHashSet(filterAssignmentsBasedOnUserPredicate(filter));
  for (  Map.Entry<String,NodeMetadata> poolNode : poolNodesToUnassign) {
    unassignNode(poolNode.getValue().getId());
  }
  return Sets.newHashSet(transform(poolNodesToUnassign,new Function<Map.Entry<String,NodeMetadata>,NodeMetadata>(){
    @Override public NodeMetadata apply(    final Map.Entry<String,NodeMetadata> input){
      assignments.remove(input.getKey(),input.getValue());
      return toFrontendNodemetadata(input.getValue(),input.getKey());
    }
  }
));
}
