{
  byte[] data=closeClientButKeepContentStream(response);
  String message=data != null ? new String(data) : null;
  Exception exception=message != null ? new HttpResponseException(command,response,message) : new HttpResponseException(command,response);
  message=message != null ? message : String.format("%s -> %s",command.getCurrentRequest().getRequestLine(),response.getStatusLine());
  Status status=Status.fromStatusCode(response.getStatusCode());
switch (status) {
case BAD_REQUEST:
    break;
case UNAUTHORIZED:
case FORBIDDEN:
  exception=new AuthorizationException(message,exception);
break;
case NOT_FOUND:
if (!command.getCurrentRequest().getMethod().equals("DELETE")) {
exception=new ResourceNotFoundException(message,exception);
}
break;
case CONFLICT:
exception=new IllegalStateException(message,exception);
break;
}
command.setException(exception);
}
