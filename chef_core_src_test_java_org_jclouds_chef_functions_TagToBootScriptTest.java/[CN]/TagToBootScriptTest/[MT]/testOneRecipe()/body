{
  Client client=createMock(Client.class);
  PrivateKey privateKey=createMock(PrivateKey.class);
  TagToBootScript fn=new TagToBootScript(URI.create("http://localhost:4000"),json,ImmutableMap.<String,Client>of("foo",client),ImmutableMap.<String,List<String>>of("foo",ImmutableList.<String>of("recipe[apache2]")),installChefGems);
  expect(client.getClientname()).andReturn("fooclient").atLeastOnce();
  expect(client.getPrivateKey()).andReturn(privateKey).atLeastOnce();
  expect(privateKey.getEncoded()).andReturn(PemsTest.PRIVATE_KEY.getBytes());
  replay(client);
  replay(privateKey);
  assertEquals(fn.apply("foo").getRawContent(),CharStreams.toString(Resources.newReaderSupplier(Resources.getResource("one-recipe.sh"),Charsets.UTF_8)));
  verify(client);
  verify(privateKey);
}
