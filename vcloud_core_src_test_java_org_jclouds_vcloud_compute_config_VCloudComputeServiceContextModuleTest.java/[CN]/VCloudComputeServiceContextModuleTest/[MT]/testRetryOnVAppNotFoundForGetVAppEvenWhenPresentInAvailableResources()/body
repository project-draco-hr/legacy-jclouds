{
  VCloudClient client=createMock(VCloudClient.class);
  VCloudComputeClient computeClient=createMock(VCloudComputeClient.class);
  Map<VAppStatus,NodeState> vAppStatusToNodeState=Maps.newHashMap();
  VApp vApp=newVApp();
  expect(client.getVApp("10")).andThrow(new NullPointerException());
  expect(client.getVApp("10")).andThrow(new NullPointerException());
  expect(client.getVApp("10")).andReturn(vApp);
  expect(computeClient.getPublicAddresses("10")).andReturn(Sets.<InetAddress>newHashSet());
  expect(computeClient.getPrivateAddresses("10")).andReturn(Sets.newHashSet(InetAddress.getLocalHost()));
  replay(client);
  replay(computeClient);
  VCloudListNodesStrategy strategy=new VCloudListNodesStrategy(client,computeClient,vAppStatusToNodeState);
  Set<ComputeMetadata> nodes=Sets.newHashSet();
  NamedResource vdc=new NamedResourceImpl("1",null,null,null);
  NamedResource resource=new NamedResourceImpl("10",null,null,null);
  strategy.addVAppToSetRetryingIfNotYetPresent(nodes,vdc,resource);
  verify(client);
  verify(computeClient);
}
