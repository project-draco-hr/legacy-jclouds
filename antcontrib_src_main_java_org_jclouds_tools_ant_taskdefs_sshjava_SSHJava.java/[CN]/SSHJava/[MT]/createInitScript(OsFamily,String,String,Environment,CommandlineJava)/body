{
  Map<String,String> envVariables=Maps.newHashMap();
  String[] environment=env.getVariables();
  if (environment != null) {
    for (int i=0; i < environment.length; i++) {
      log("Setting environment variable: " + environment[i],Project.MSG_DEBUG);
      String[] keyValue=environment[i].split("=");
      envVariables.put(keyValue[0],keyValue[1]);
    }
  }
  StringBuilder commandBuilder=new StringBuilder(commandLine.getVmCommand().getExecutable());
  if (commandLine.getBootclasspath() != null) {
    commandBuilder.append(" -Xbootclasspath:bootclasspath");
    resetPathToUnderPrefixIfExistsAndIsFileIfNotExistsAddAsIs(commandLine.getBootclasspath(),"bootclasspath",commandBuilder);
  }
  if (commandLine.getVmCommand().getArguments() != null && commandLine.getVmCommand().getArguments().length > 0) {
    commandBuilder.append(" ").append(Joiner.on(' ').join(commandLine.getVmCommand().getArguments()));
  }
  commandBuilder.append(" -cp classpath");
  resetPathToUnderPrefixIfExistsAndIsFileIfNotExistsAddAsIs(commandLine.getClasspath(),"classpath",commandBuilder);
  if (commandLine.getSystemProperties() != null && commandLine.getSystemProperties().getVariables() != null && commandLine.getSystemProperties().getVariables().length > 0) {
    commandBuilder.append(" ").append(Joiner.on(' ').join(commandLine.getSystemProperties().getVariables()));
  }
  commandBuilder.append(" ").append(commandLine.getClassname());
  if (commandLine.getJavaCommand().getArguments() != null && commandLine.getJavaCommand().getArguments().length > 0) {
    commandBuilder.append(" ").append(Joiner.on(' ').join(commandLine.getJavaCommand().getArguments()));
  }
  InitScript testInitBuilder=InitScript.builder().name(id).home(basedir).exportVariables(envVariables).run(Statements.interpret(commandBuilder.toString())).build();
  return testInitBuilder.render(osFamily);
}
