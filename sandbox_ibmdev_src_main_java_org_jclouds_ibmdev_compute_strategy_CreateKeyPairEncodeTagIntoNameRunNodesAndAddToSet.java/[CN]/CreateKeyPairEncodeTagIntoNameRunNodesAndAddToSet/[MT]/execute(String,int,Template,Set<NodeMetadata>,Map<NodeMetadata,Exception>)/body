{
  Payload key=template.getOptions().getPublicKey();
  if (key != null) {
    String keyAsText;
    try {
      keyAsText=Utils.toStringAndClose(key.getInput());
    }
 catch (    IOException e1) {
      throw new RuntimeException(e1);
    }
    template.getOptions().dontAuthorizePublicKey();
    try {
      client.addPublicKey(tag,keyAsText);
    }
 catch (    IllegalStateException e) {
      client.updatePublicKey(tag,keyAsText);
    }
  }
 else {
    credentialsMap.put(tag,client.generateKeyPair(tag).getKeyMaterial());
  }
  return super.execute(tag,count,template,nodes,badNodes);
}
