{
  String controllerIDE="IDE Controller";
  IMedium distroMedium=createNiceMock(IMedium.class);
  IMachine machine=createNiceMock(IMachine.class);
  final StringBuilder errorBuilder=new StringBuilder();
  errorBuilder.append("VirtualBox error: ");
  errorBuilder.append("Medium '/Users/johndoe/jclouds-virtualbox-test/ubuntu-11.04-server-i386.iso' ");
  errorBuilder.append("is already attached to port 0, device 0 of controller 'IDE Controller' ");
  errorBuilder.append("of this virtual machine (0x80BB000C)");
  String isoAlreadyAttachedException=errorBuilder.toString();
  VBoxException isoAttachedException=new VBoxException(createNiceMock(Throwable.class),isoAlreadyAttachedException);
  machine.attachDevice(controllerIDE,0,0,DeviceType.DVD,distroMedium);
  expectLastCall().andThrow(isoAttachedException);
  replay(machine,distroMedium);
  new AttachDistroMediumToMachine(controllerIDE,distroMedium).apply(machine);
  verify(machine);
}
