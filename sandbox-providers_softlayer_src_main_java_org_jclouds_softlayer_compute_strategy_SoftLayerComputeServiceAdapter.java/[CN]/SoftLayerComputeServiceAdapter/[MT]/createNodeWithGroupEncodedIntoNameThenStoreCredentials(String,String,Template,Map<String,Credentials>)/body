{
  Iterable<VirtualGuest> existing=findVirtualGuests(name,group);
  if (!Iterables.isEmpty(existing)) {
    throw new IllegalStateException("VirtualGuest(s) already exist with hostname:" + name + ", group:"+ group+ ". Existing:"+ existing);
  }
  VirtualGuest newGuest=VirtualGuest.builder().domain(group).hostname(name).build();
  ProductOrder order=ProductOrder.builder().packageId(getProductPackage().getId()).location(template.getLocation().getId()).quantity(1).useHourlyPricing(true).prices(getPrices(template)).virtualGuest(newGuest).build();
  client.getVirtualGuestClient().orderVirtualGuest(order);
  VirtualGuest result=Iterables.getOnlyElement(findVirtualGuests(name,group));
  Credentials credentials=new Credentials(null,null);
  OperatingSystem os=result.getOperatingSystem();
  if (os != null) {
    Set<Password> passwords=os.getPasswords();
    if (passwords.size() > 0) {
      Password pw=Iterables.get(passwords,0);
      credentials=new Credentials(pw.getUsername(),pw.getPassword());
    }
  }
  credentialStore.put("node#" + result.getId(),credentials);
  return result;
}
