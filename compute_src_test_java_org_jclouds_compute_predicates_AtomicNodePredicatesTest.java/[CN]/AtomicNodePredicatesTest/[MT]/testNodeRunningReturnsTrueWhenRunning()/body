{
  expect(node.getState()).andReturn(NodeState.RUNNING).atLeastOnce();
  replay(node);
  replay(computeService);
  AtomicNodeRunning nodeRunning=new AtomicNodeRunning(computeService);
  AtomicReference<NodeMetadata> reference=new AtomicReference<NodeMetadata>(node);
  Assert.assertTrue(nodeRunning.apply(reference));
  Assert.assertEquals(reference.get(),node);
}
