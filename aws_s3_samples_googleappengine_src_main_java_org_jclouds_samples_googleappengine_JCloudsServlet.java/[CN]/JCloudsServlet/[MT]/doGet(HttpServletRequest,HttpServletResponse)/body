{
  try {
    List<S3Bucket.Metadata> myBucketMetadata=context.getConnection().listOwnedBuckets();
    List<BucketResult> myBuckets=new ArrayList<BucketResult>();
    for (    S3Bucket.Metadata metadata : myBucketMetadata) {
      BucketResult result=new BucketResult();
      result.setName(metadata.getName());
      try {
        S3Bucket bucket=context.getConnection().listBucket(metadata.getName()).get(10,TimeUnit.SECONDS);
        if (bucket == S3Bucket.NOT_FOUND) {
          result.setStatus("not found");
        }
 else {
          result.setSize(bucket.getSize() + "");
        }
      }
 catch (      Exception e) {
        logger.error(e,"Error listing bucket %1$s",result.getName());
        result.setStatus(e.getMessage());
      }
      myBuckets.add(result);
    }
    request.setAttribute("buckets",myBuckets);
    request.setAttribute("className",className);
    String nextJSP="/WEB-INF/jsp/buckets.jsp";
    RequestDispatcher dispatcher=getServletContext().getRequestDispatcher(nextJSP);
    dispatcher.forward(request,response);
  }
 catch (  Exception e) {
    logger.error(e,"Error listing buckets");
    throw new ServletException(e);
  }
}
