{
  Thread thread=new Thread(){
    public void run(){
      while (!channel.isClosed()) {
        try {
          sleep(RETRY_INTERVAL);
        }
 catch (        InterruptedException e) {
        }
      }
    }
  }
;
  thread.start();
  try {
    thread.join(maxwait);
  }
 catch (  InterruptedException e) {
  }
  if (thread.isAlive()) {
    thread.destroy();
    throw new TimeoutException("command still running");
  }
}
