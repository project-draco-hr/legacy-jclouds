{
  logger.debug(">> destroying nodes matching(%s)",filter);
  Map<NodeMetadata,ListenableFuture<Void>> responses=Maps.newHashMap();
  final Set<NodeMetadata> destroyedNodes=Sets.newLinkedHashSet();
  for (  final NodeMetadata node : nodesMatchingFilterAndNotTerminated(filter)) {
    responses.put(node,makeListenable(executor.submit(new Callable<Void>(){
      @Override public Void call() throws Exception {
        destroyNode(node.getHandle());
        destroyedNodes.add(node);
        return null;
      }
    }
),executor));
  }
  awaitCompletion(responses,executor,null,logger,"destroying nodes");
  logger.debug("<< destroyed");
  return destroyedNodes;
}
