{
  logger.debug(">> destroying nodes matching(%s)",filter);
  Set<NodeMetadata> set=newLinkedHashSet(filter(transformParallel(nodesMatchingFilterAndNotTerminated(filter),new Function<NodeMetadata,Future<NodeMetadata>>(){
    @Override public Future<NodeMetadata> apply(    final NodeMetadata from){
      return executor.submit(new Callable<NodeMetadata>(){
        @Nullable @Override public NodeMetadata call() throws Exception {
          doDestroyNode(from.getId());
          return from;
        }
        @Override public String toString(){
          return "destroyNode(" + from.getId() + ")";
        }
      }
);
    }
  }
,executor,null,logger,"destroyNodesMatching(" + filter + ")"),notNull()));
  logger.debug("<< destroyed(%d)",set.size());
  cleanUpIncidentalResourcesOfDeadNodes(set);
  return set;
}
