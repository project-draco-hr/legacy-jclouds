{
  logger.debug(">> rebooting nodes by tag(%s)",tag);
  Iterable<? extends NodeMetadata> nodesToReboot=Iterables.filter(doListNodesWithTag(tag),new Predicate<NodeMetadata>(){
    @Override public boolean apply(    NodeMetadata input){
      return input.getState() != NodeState.TERMINATED;
    }
  }
);
  Map<NodeMetadata,ListenableFuture<Void>> responses=Maps.newHashMap();
  for (  final NodeMetadata node : nodesToReboot) {
    responses.put(node,makeListenable(executor.submit(new Callable<Void>(){
      @Override public Void call() throws Exception {
        rebootNode(node);
        return null;
      }
    }
),executor));
  }
  awaitCompletion(responses,executor,null,logger,"rebooting nodes");
  logger.debug("<< rebooted");
}
