{
  ScheduledFuture mockFuture=EasyMock.createMock(ScheduledFuture.class);
  expect(mockFuture.isCancelled()).andReturn(false);
  expect(mockFuture.isDone()).andReturn(false);
  expect(mockFuture.cancel(false)).andReturn(true);
  ScheduledExecutorService schedulerMock=EasyMock.createMock(ScheduledExecutorService.class);
  expect(schedulerMock.scheduleWithFixedDelay(anyObject(Runnable.class),anyLong(),anyLong(),anyObject(TimeUnit.class))).andReturn(mockFuture);
  replay(mockFuture);
  replay(schedulerMock);
  AsyncMonitor<Object> monitor=mockMonitor(schedulerMock,new Object(),mockFunction(MonitorStatus.DONE),new EventBus());
  assertNull(monitor.getFuture());
  assertNull(monitor.getTimeout());
  monitor.startMonitoring(null);
  assertNotNull(monitor.getFuture());
  assertNull(monitor.getTimeout());
  monitor.stopMonitoring();
  verify(mockFuture);
  verify(schedulerMock);
}
