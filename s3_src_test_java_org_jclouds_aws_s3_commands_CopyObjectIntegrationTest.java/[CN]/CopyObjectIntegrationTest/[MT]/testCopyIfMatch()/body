{
  String sourceBucket=bucketPrefix + "testCopyIfMatch";
  String sourceKey="apples";
  byte[] realMd5=S3Utils.md5(TEST_STRING);
  byte[] badMd5=S3Utils.md5("alf");
  String destinationBucket=bucketPrefix + "testCopyIfMatchDestination";
  String destinationKey="pears";
  setupSourceBucket(sourceBucket,sourceKey);
  createBucketAndEnsureEmpty(destinationBucket);
  client.copyObject(sourceBucket,sourceKey,destinationBucket,destinationKey,ifSourceMd5Matches(realMd5)).get(10,TimeUnit.SECONDS);
  validateContent(destinationBucket,destinationKey);
  try {
    client.copyObject(sourceBucket,sourceKey,destinationBucket,destinationKey,ifSourceMd5Matches(badMd5)).get(10,TimeUnit.SECONDS);
  }
 catch (  ExecutionException e) {
    S3ResponseException ex=(S3ResponseException)e.getCause();
    assertEquals(ex.getResponse().getStatusCode(),412);
  }
}
