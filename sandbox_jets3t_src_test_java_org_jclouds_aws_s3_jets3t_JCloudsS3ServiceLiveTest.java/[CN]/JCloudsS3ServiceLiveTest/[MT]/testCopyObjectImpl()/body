{
  String bucketName=getContainerName();
  try {
    String data="This is my data";
    String sourceObjectKey="???riginalObject";
    String destinationObjectKey="d???stinationObject";
    String metadataName="metadata-name";
    String sourceMetadataValue="souce-metadata-value";
    String destinationMetadataValue="destination-metadata-value";
    Blob blob=context.getAsyncBlobStore().newBlob(sourceObjectKey);
    blob.setPayload(data);
    blob.getMetadata().getUserMetadata().put(metadataName,sourceMetadataValue);
    addBlobToContainer(bucketName,blob);
    S3Object destinationObject;
    Map copyResult;
    org.jclouds.aws.s3.domain.S3Object jcDestinationObject;
    destinationObject=new S3Object(destinationObjectKey);
    copyResult=service.copyObject(bucketName,sourceObjectKey,bucketName,destinationObject,false);
    jcDestinationObject=getApi().getObject(bucketName,destinationObject.getKey());
    assertEquals(jcDestinationObject.getMetadata().getUserMetadata().get(metadataName),sourceMetadataValue);
    assertEquals(copyResult.get("ETag"),jcDestinationObject.getMetadata().getETag());
    org.jclouds.aws.s3.domain.AccessControlList jcACL=getApi().getObjectACL(bucketName,destinationObject.getKey());
    assertEquals(jcACL.getGrants().size(),1);
    assertTrue(jcACL.hasPermission(jcACL.getOwner().getId(),Permission.FULL_CONTROL));
    destinationObject=new S3Object(destinationObjectKey);
    destinationObject.addMetadata("x-amz-meta-" + metadataName,destinationMetadataValue);
    copyResult=service.copyObject(bucketName,sourceObjectKey,bucketName,destinationObject,true);
    jcDestinationObject=getApi().getObject(bucketName,destinationObject.getKey());
    assertEquals(jcDestinationObject.getMetadata().getUserMetadata().get(metadataName),destinationMetadataValue);
    jcACL=getApi().getObjectACL(bucketName,destinationObject.getKey());
    assertEquals(jcACL.getGrants().size(),1);
    assertTrue(jcACL.hasPermission(jcACL.getOwner().getId(),Permission.FULL_CONTROL));
    destinationObject=new S3Object(destinationObjectKey);
    destinationObject.setAcl(AccessControlList.REST_CANNED_PUBLIC_READ);
    copyResult=service.copyObject(bucketName,sourceObjectKey,bucketName,destinationObject,false);
    jcACL=getApi().getObjectACL(bucketName,destinationObject.getKey());
    assertEquals(jcACL.getGrants().size(),2);
    assertTrue(jcACL.hasPermission(jcACL.getOwner().getId(),Permission.FULL_CONTROL));
    assertTrue(jcACL.hasPermission(GroupGranteeURI.ALL_USERS,Permission.READ));
  }
  finally {
    returnContainer(bucketName);
  }
}
