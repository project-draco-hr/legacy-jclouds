{
  Set<Ip> availableIps=client.getIpServices().getUnassignedIpList();
  Ip availableIp=Iterables.getLast(availableIps);
  Server addedServer=client.getServerServices().addServer(name,checkNotNull(template.getImage().getId()),sizeToRam.apply(template.getSize()),availableIp.getIp());
  serverLatestJobCompleted.apply(addedServer);
  client.getServerServices().power(addedServer.getName(),PowerCommand.START);
  serverLatestJobCompleted.apply(addedServer);
  addedServer=Iterables.getOnlyElement(client.getServerServices().getServersByName(addedServer.getName()));
  return serverToNodeMetadata.apply(addedServer);
}
