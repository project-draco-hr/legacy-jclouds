{
  checkNotNull(options,"options");
  logger.debug(">> instantiating vApp vDC(%s) template(%s) name(%s) options(%s) ",VDC,templateId,name,options);
  VDC vdc=client.getVDC(VDC);
  VCloudExpressVAppTemplate template=VCloudExpressClient.class.cast(client).getVAppTemplate(templateId);
  VCloudExpressVApp vAppResponse=VCloudExpressClient.class.cast(client).instantiateVAppTemplateInVDC(vdc.getId(),template.getId(),name,options);
  logger.debug("<< instantiated VApp(%s)",vAppResponse.getName());
  logger.debug(">> deploying vApp(%s)",vAppResponse.getName());
  Task task=client.deployVApp(vAppResponse.getId());
  if (options.shouldBlockOnDeploy()) {
    if (!taskTester.apply(task.getLocation())) {
      throw new RuntimeException(String.format("failed to %s %s: %s","deploy",vAppResponse.getName(),task));
    }
    logger.debug("<< deployed vApp(%s)",vAppResponse.getName());
    logger.debug(">> powering vApp(%s)",vAppResponse.getName());
    task=client.powerOnVApp(vAppResponse.getId());
    if (!taskTester.apply(task.getLocation())) {
      throw new RuntimeException(String.format("failed to %s %s: %s","powerOn",vAppResponse.getName(),task));
    }
    logger.debug("<< on vApp(%s)",vAppResponse.getName());
  }
  return parseAndValidateResponse(template,vAppResponse);
}
