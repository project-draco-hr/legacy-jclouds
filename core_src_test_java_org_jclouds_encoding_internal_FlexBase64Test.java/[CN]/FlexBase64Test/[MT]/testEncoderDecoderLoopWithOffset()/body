{
  byte[] nums=new byte[32768];
  for (int i=0; i < 32768; i++) {
    nums[i]=(byte)(i % 255);
  }
  byte[] output=new byte[65535];
  FlexBase64.Encoder encoder=FlexBase64.createEncoder(true);
  int opos=5;
  int pos=0;
  while (pos < 32768) {
    opos=encoder.encode(nums,pos,nums.length,output,opos,opos + 10000);
    pos=encoder.getLastInputPosition();
  }
  opos=encoder.complete(output,opos);
  byte[] decode=new byte[nums.length];
  FlexBase64.Decoder decoder=FlexBase64.createDecoder();
  int stop=opos;
  pos=5;
  int last=0;
  while (pos < stop) {
    last=decoder.decode(output,pos,stop,decode,last,last + 10000);
    pos=decoder.getLastInputPosition();
  }
  Assert.assertEquals(nums.length,last);
  for (int i=0; i < last; i++) {
    Assert.assertEquals(nums[i],decode[i]);
  }
}
