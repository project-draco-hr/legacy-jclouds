{
  for (  String zoneId : context.getApi().getConfiguredZones()) {
    SecurityGroupClient client=context.getApi().getSecurityGroupExtensionForZone(zoneId).get();
    SecurityGroup securityGroup=null;
    try {
      securityGroup=client.createSecurityGroupWithNameAndDescription(SECURITY_GROUP_NAME,"test security group");
      assertNotNull(securityGroup);
      SecurityGroupRule rule=client.createSecurityGroupRuleAllowingCidrBlock(securityGroup.getId(),Ingress.builder().ipProtocol(IpProtocol.TCP).fromPort(443).toPort(443).build(),"0.0.0.0/0");
      assertNotNull(rule);
      SecurityGroupRule rule2=client.createSecurityGroupRuleAllowingSecurityGroupId(securityGroup.getId(),Ingress.builder().ipProtocol(IpProtocol.TCP).fromPort(443).toPort(443).build(),securityGroup.getId());
      assertNotNull(rule2);
      securityGroup=client.getSecurityGroup(securityGroup.getId());
    }
  finally {
      if (securityGroup != null) {
        client.deleteSecurityGroup(securityGroup.getId());
      }
    }
  }
}
