{
  URI templateUri=URI.create("https://vcenterprise.bluelock.com/api/v1.0/vAppTemplate/3");
  VAppTemplate template=createMock(VAppTemplate.class);
  VCloudNetworkSection net=createMock(VCloudNetworkSection.class);
  InstantiateVAppTemplateOptions options=customizeOnInstantiate(true);
  String expected=Strings2.toStringAndClose(getClass().getResourceAsStream("/instantiationparams-customization.xml"));
  GeneratedHttpRequest<?> request=createMock(GeneratedHttpRequest.class);
  expect(request.getEndpoint()).andReturn(URI.create("http://localhost/key")).anyTimes();
  expect(request.getArgs()).andReturn(ImmutableList.<Object>of(options)).atLeastOnce();
  request.setPayload(expected);
  expect(template.getNetworkSection()).andReturn(net).atLeastOnce();
  expect(net.getNetworks()).andReturn(ImmutableSet.<org.jclouds.vcloud.domain.ovf.network.Network>of(new org.jclouds.vcloud.domain.ovf.network.Network("vAppNet-vApp Internal",null)));
  replay(request);
  replay(template);
  replay(net);
  BindInstantiateVAppTemplateParamsToXmlPayload binder=createInjector(templateUri,template).getInstance(BindInstantiateVAppTemplateParamsToXmlPayload.class);
  Map<String,String> map=Maps.newHashMap();
  map.put("name","my-vapp");
  map.put("template","https://vcenterprise.bluelock.com/api/v1.0/vAppTemplate/3");
  binder.bindToRequest(request,map);
  verify(request);
  verify(template);
  verify(net);
}
