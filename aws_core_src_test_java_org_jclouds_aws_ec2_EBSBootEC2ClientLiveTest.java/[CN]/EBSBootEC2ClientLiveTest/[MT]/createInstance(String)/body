{
  RunningInstance instance=null;
  while (instance == null) {
    try {
      System.out.printf("%d: running instance%n",System.currentTimeMillis());
      Reservation reservation=client.getInstanceServices().runInstancesInRegion(Region.DEFAULT,null,imageId,1,1,withKeyName(keyPair.getKeyName()).asType(InstanceType.M1_SMALL).withSecurityGroup(securityGroupName));
      instance=Iterables.getOnlyElement(reservation.getRunningInstances());
    }
 catch (    HttpResponseException htpe) {
      if (htpe.getResponse().getStatusCode() == 400)       continue;
      throw htpe;
    }
  }
  assertNotNull(instance.getId());
  assertEquals(instance.getInstanceState(),InstanceState.PENDING);
  instance=blockUntilWeCanSshIntoInstance(instance);
  return instance;
}
