{
  VmSpec vmSpec=machineSpec.getVmSpec();
  IsoSpec isoSpec=machineSpec.getIsoSpec();
  String vmName=vmSpec.getVmName();
  final IMachine vm=createAndRegisterMachineFromIsoIfNotAlreadyExists.apply(machineSpec);
  ensureMachineIsLaunched(vmName);
  URI uri=isoSpec.getPreConfigurationUri().get();
  String installationKeySequence=isoSpec.getInstallationKeySequence().replace("PRECONFIGURATION_URL",uri.toASCIIString());
  sendKeyboardSequence(installationKeySequence,vmName);
  SshClient client=sshClientForIMachine.apply(vm);
  logger.debug(">> awaiting installation to finish node(%s)",vmName);
  checkState(sshResponds.apply(client),"timed out waiting for guest %s to be accessible via ssh",vmName);
  logger.debug("<< installation of image complete. Powering down node(%s)",vmName);
  ensureMachineHasPowerDown(vmName);
  return vm;
}
