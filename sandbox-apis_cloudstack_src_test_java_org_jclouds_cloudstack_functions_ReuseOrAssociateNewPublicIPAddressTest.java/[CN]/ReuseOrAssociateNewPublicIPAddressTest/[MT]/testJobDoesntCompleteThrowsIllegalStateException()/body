{
  long networkId=99l;
  long zoneId=100l;
  CloudStackClient client=createMock(CloudStackClient.class);
  Predicate<Long> jobComplete=Predicates.alwaysFalse();
  AddressClient addressClient=createMock(AddressClient.class);
  expect(client.getAddressClient()).andReturn(addressClient).atLeastOnce();
  expect(addressClient.listPublicIPAddresses(allocatedOnly(true).networkId(networkId))).andReturn(ImmutableSet.<PublicIPAddress>of());
  AsyncCreateResponse job=new AsyncCreateResponse(1,2);
  expect(addressClient.associateIPAddressInZone(zoneId,networkId(networkId))).andReturn(job);
  replay(client);
  replay(addressClient);
  new ReuseOrAssociateNewPublicIPAddress(client,jobComplete).apply(Network.builder().id(networkId).zoneId(zoneId).build());
  verify(client);
  verify(addressClient);
}
