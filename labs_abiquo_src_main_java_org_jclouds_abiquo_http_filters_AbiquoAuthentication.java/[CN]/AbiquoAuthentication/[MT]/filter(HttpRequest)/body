{
  Credentials currentCreds=checkNotNull(creds.get(),"credential supplier returned null");
  String header=credentialIsToken ? tokenAuth(currentCreds.credential) : basic(currentCreds.identity,currentCreds.credential);
  return request.toBuilder().replaceHeader(credentialIsToken ? HttpHeaders.COOKIE : HttpHeaders.AUTHORIZATION,header).build();
}
