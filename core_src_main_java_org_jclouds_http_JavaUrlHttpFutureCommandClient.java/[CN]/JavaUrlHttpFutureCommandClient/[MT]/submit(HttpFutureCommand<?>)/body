{
  HttpRequest request=(HttpRequest)command.getRequest();
  HttpURLConnection connection=null;
  try {
    for (    HttpRequestFilter filter : getRequestFilters()) {
      filter.filter(request);
    }
    HttpResponse response=null;
    for (; ; ) {
      try {
        logger.trace("%1s - converting request %2s",target,request);
        connection=openJavaConnection(request);
        logger.trace("%1s - submitting request %2s",target,connection);
        response=getResponse(connection);
        logger.trace("%1s - received response %2s",target,response);
        if (request.isReplayable() && response.getStatusCode() >= 500) {
          logger.info("resubmitting command: %1s",command);
          continue;
        }
        break;
      }
 catch (      IOException e) {
        if (request.isReplayable() && e.getMessage().indexOf("Server returned HTTP response code: 5") >= 0) {
          logger.info("resubmitting command: %1s",command);
          continue;
        }
        throw e;
      }
    }
    command.getResponseFuture().setResponse(response);
    command.getResponseFuture().run();
  }
 catch (  FileNotFoundException e) {
    HttpResponse response=new HttpResponse();
    response.setStatusCode(404);
    command.getResponseFuture().setResponse(response);
    command.getResponseFuture().run();
  }
catch (  Exception e) {
    if (connection != null) {
      StringBuilder errors=new StringBuilder();
      try {
        for (        InputStream in : new InputStream[]{connection.getErrorStream(),connection.getInputStream()}) {
          if (in != null) {
            errors.append(Utils.toStringAndClose(in)).append("\n");
          }
        }
        logger.error(e,"error encountered during the exception: %1s",errors.toString());
      }
 catch (      IOException e2) {
      }
    }
    command.setException(e);
  }
 finally {
    if (request.getMethod().equals("HEAD"))     connection.disconnect();
  }
}
