{
  addContextModule(modules);
  addClientModuleIfNotPresent(modules);
  addLoggingModuleIfNotPresent(modules);
  addHttpModuleIfNeededAndNotPresent(modules);
  ifHttpConfigureRestOtherwiseGuiceClientFactory(modules);
  addExecutorServiceIfNotPresent(modules);
  addCredentialStoreIfNotPresent(modules);
  modules.add(new LifeCycleModule());
  modules.add(new BindPropertiesAndPrincipalContext(properties));
  Injector returnVal=Guice.createInjector(Stage.PRODUCTION,modules);
  returnVal.getInstance(ExecutionList.class).execute();
  return returnVal;
}
