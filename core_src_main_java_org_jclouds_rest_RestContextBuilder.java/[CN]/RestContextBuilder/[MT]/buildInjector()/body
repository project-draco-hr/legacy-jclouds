{
  modules.add(Rocoto.expandVariables(new ConfigurationModule(){
    @Override protected void bindConfigurations(){
      Properties toBind=new Properties();
      toBind.putAll(checkNotNull(properties,"properties"));
      toBind.putAll(System.getProperties());
      bindProperties(toBind);
    }
  }
));
  addContextModule(modules);
  addClientModuleIfNotPresent(modules);
  addLoggingModuleIfNotPresent(modules);
  addHttpModuleIfNeededAndNotPresent(modules);
  ifHttpConfigureRestOtherwiseGuiceClientFactory(modules);
  addExecutorServiceIfNotPresent(modules);
  addEventBusIfNotPresent(modules);
  addCredentialStoreIfNotPresent(modules);
  modules.add(new LifeCycleModule());
  modules.add(new BindPropertiesToAnnotations());
  Injector returnVal=Guice.createInjector(Stage.PRODUCTION,modules);
  returnVal.getInstance(ExecutionList.class).execute();
  return returnVal;
}
