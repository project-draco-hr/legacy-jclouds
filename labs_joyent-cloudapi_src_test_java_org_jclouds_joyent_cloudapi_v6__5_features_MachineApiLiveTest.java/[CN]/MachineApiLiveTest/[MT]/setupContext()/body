{
  super.setupContext();
  key=SshKeys.generate();
  fingerprint=SshKeys.fingerprintPublicKey(key.get("public"));
  cloudApiContext.getApi().getKeyApi().create(Key.builder().name(fingerprint).key(key.get("public")).build());
  api=cloudApiContext.getApi().getMachineApiForDatacenter(Iterables.get(cloudApiContext.getApi().getConfiguredDatacenters(),0));
  socketTester=retry(new InetSocketAddressConnect(),180,1,1,SECONDS);
  machineRunning=retry(new Predicate<Machine>(){
    public boolean apply(    Machine input){
      return api.get(input.getId()).getState() == Machine.State.RUNNING;
    }
  }
,600,5,5,SECONDS);
}
