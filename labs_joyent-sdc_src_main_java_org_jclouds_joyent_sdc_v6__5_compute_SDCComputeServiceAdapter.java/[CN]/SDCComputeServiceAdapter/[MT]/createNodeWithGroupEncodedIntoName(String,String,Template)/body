{
  LoginCredentials.Builder credentialsBuilder=LoginCredentials.builder();
  CreateMachineOptions options=new CreateMachineOptions();
  options.name(name);
  options.packageName(template.getHardware().getProviderId());
  options.metadata(metadataAndTagsAsCommaDelimitedValue(template.getOptions()));
  String datacenterId=template.getLocation().getId();
  String datasetURN=template.getImage().getProviderId();
  logger.debug(">> creating new machine datacenter(%s) datasetURN(%s) options(%s)",datacenterId,datasetURN,options);
  Machine machine=sdcClient.getMachineClientForDatacenter(datacenterId).createWithDataset(datasetURN,options);
  logger.trace("<< machine(%s)",machine.getId());
  MachineInDatacenter machineInDatacenter=new MachineInDatacenter(machine,datacenterId);
  if (template.getOptions().getLoginPrivateKey() != null) {
    credentialsBuilder.privateKey(template.getOptions().getLoginPrivateKey());
  }
  return new NodeAndInitialCredentials<MachineInDatacenter>(machineInDatacenter,machineInDatacenter.slashEncode(),credentialsBuilder.build());
}
