{
  IPSocket socket=new IPSocket(Iterables.get(newDetails.getAddresses().getPublicAddresses(),0),22);
  socketTester.apply(socket);
  SshClient client=sshFactory.create(socket,new Credentials("root",pass));
  try {
    client.connect();
    Payload etcPasswd=client.get("/etc/jclouds.txt");
    String etcPasswdContents=Utils.toStringAndClose(etcPasswd.getInput());
    assertEquals("rackspace",etcPasswdContents.trim());
  }
  finally {
    if (client != null)     client.disconnect();
  }
}
