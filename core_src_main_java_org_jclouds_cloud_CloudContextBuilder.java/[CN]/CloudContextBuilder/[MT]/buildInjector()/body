{
  useDefaultPortIfNotPresent(properties);
  addLoggingModuleIfNotPresent(modules);
  addParserModuleIfNotPresent(modules);
  addConnectionModuleIfNotPresent(modules);
  addHttpModuleIfNeededAndNotPresent(modules);
  addExecutorServiceIfNotPresent(modules);
  modules.add(new AbstractModule(){
    @Override protected void configure(){
      Jsr330.bindProperties(binder(),checkNotNull(properties,"properties"));
    }
  }
);
  addContextModule(modules);
  return Guice.createInjector(modules);
}
