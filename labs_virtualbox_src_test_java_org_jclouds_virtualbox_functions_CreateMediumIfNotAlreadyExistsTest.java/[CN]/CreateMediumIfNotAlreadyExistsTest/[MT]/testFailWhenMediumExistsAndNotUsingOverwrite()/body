{
  HardDisk hardDisk=createTestHardDisk();
  VirtualBoxManager manager=createNiceMock(VirtualBoxManager.class);
  MachineUtils machineUtils=createMock(MachineUtils.class);
  IMachine machine=createMock(IMachine.class);
  IVirtualBox vBox=createMock(IVirtualBox.class);
  IMedium medium=createMock(IMedium.class);
  IMedium newHardDisk=createMock(IMedium.class);
  IProgress progress=createNiceMock(IProgress.class);
  expect(manager.getVBox()).andReturn(vBox).anyTimes();
  expect(vBox.openMedium(adminDiskPath,DeviceType.HardDisk,AccessMode.ReadWrite,false)).andReturn(medium);
  replay(manager,machine,vBox,medium,newHardDisk,progress,machineUtils);
  new CreateMediumIfNotAlreadyExists(Suppliers.ofInstance(manager),machineUtils,false).apply(hardDisk);
}
