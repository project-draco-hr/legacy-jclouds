{
  File file=allocateFile();
  checkState(file != null,"file was null");
  if (metadata != null) {
    return new BlobStoreOutputStream(file,getBlobStore(),BlobStoreUtils.newBlob(getBlobStore(),metadata));
  }
 else {
    return new BlobStoreOutputStream(file,getBlobStore(),getBlobStore().newBlob(getNameTrimLeadingSlashes()));
  }
}
