{
  boolean isDefaultSmtpServer=emailSettings.isDefaultSmtpServer();
  boolean isDefaultOrgEmail=emailSettings.isDefaultOrgEmail();
  String oldFromEmailAddress=emailSettings.getFromEmailAddress();
  String newFromEmailAddress="test@test.com";
  String oldDefaultSubjectPrefix=emailSettings.getDefaultSubjectPrefix();
  String newDefaultSubjectPrefix="new" + oldDefaultSubjectPrefix;
  boolean isAlertEmailToAllAdmins=emailSettings.isAlertEmailToAllAdmins();
  SmtpServerSettings oldSmtpServerSettings=emailSettings.getSmtpServerSettings();
  SmtpServerSettings newSmtpServerSettings=oldSmtpServerSettings.toBuilder().useAuthentication(!oldSmtpServerSettings.useAuthentication()).host("new" + oldSmtpServerSettings.getHost()).username("new" + oldSmtpServerSettings.getUsername()).password("new" + oldSmtpServerSettings.getPassword()).build();
  try {
    OrgEmailSettings newEmailSettings=emailSettings.toBuilder().isDefaultSmtpServer(!isDefaultSmtpServer).isDefaultOrgEmail(!isDefaultOrgEmail).fromEmailAddress(newFromEmailAddress).defaultSubjectPrefix(newDefaultSubjectPrefix).isAlertEmailToAllAdmins(!isAlertEmailToAllAdmins).smtpServerSettings(newSmtpServerSettings).build();
    emailSettings=orgApi.updateEmailSettings(orgRef.getHref(),newEmailSettings);
    assertTrue(equal(emailSettings.isDefaultSmtpServer(),!isDefaultSmtpServer),String.format(OBJ_FIELD_UPDATABLE,"emailSettings","isDefaultSmtpServer"));
    assertTrue(equal(emailSettings.isDefaultOrgEmail(),!isDefaultOrgEmail),String.format(OBJ_FIELD_UPDATABLE,"emailSettings","isDefaultOrgEmail"));
    assertTrue(equal(emailSettings.getFromEmailAddress(),newFromEmailAddress),String.format(OBJ_FIELD_UPDATABLE,"emailSettings","fromEmailAddress"));
    assertTrue(equal(emailSettings.getDefaultSubjectPrefix(),newDefaultSubjectPrefix),String.format(OBJ_FIELD_UPDATABLE,"emailSettings","defaultSubjectPrefix"));
    assertTrue(equal(emailSettings.isAlertEmailToAllAdmins(),!isAlertEmailToAllAdmins),String.format(OBJ_FIELD_UPDATABLE,"emailSettings","isAlertEmailToAllAdmins"));
    assertTrue(equal(emailSettings.getSmtpServerSettings(),newSmtpServerSettings),String.format(OBJ_FIELD_UPDATABLE,"emailSettings","smtpServerSettings"));
    Checks.checkEmailSettings(emailSettings);
  }
  finally {
    emailSettings=emailSettings.toBuilder().isDefaultSmtpServer(isDefaultSmtpServer).isDefaultOrgEmail(isDefaultOrgEmail).fromEmailAddress(oldFromEmailAddress).defaultSubjectPrefix(oldDefaultSubjectPrefix).isAlertEmailToAllAdmins(isAlertEmailToAllAdmins).smtpServerSettings(oldSmtpServerSettings).build();
    emailSettings=orgApi.updateEmailSettings(orgRef.getHref(),emailSettings);
  }
}
