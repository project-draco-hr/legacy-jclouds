{
  StringPayload imageData=new StringPayload("This isn't an image!");
  for (  String zoneId : glanceContext.getApi().getConfiguredRegions()) {
    ImageClient client=glanceContext.getApi().getImageClientForRegion(zoneId);
    ImageDetails details=client.reserve("jclouds-live-res-test",diskFormat(DiskFormat.RAW),containerFormat(ContainerFormat.BARE));
    assertEquals(details.getName(),"jclouds-live-res-test");
    details=client.upload(details.getId(),imageData,UpdateImageOptions.Builder.name("jclouds-live-res-test2"),UpdateImageOptions.Builder.minDisk(10));
    assertEquals(details.getName(),"jclouds-live-res-test2");
    assertEquals(details.getSize().get().longValue(),imageData.getRawContent().length());
    assertEquals(details.getMinDisk(),10);
    Image fromListing=Iterables.getOnlyElement(client.list(ListImageOptions.Builder.name("jclouds-live-res-test2"),ListImageOptions.Builder.maxResults(2),ListImageOptions.Builder.containerFormat(ContainerFormat.BARE)));
    assertEquals(fromListing.getId(),details.getId());
    assertEquals(fromListing.getSize(),details.getSize());
    assertEquals(Iterables.getOnlyElement(client.listInDetail(ListImageOptions.Builder.name("jclouds-live-res-test2"))),details);
    assertTrue(client.delete(details.getId()));
    assertTrue(client.list(ListImageOptions.Builder.name("jclouds-live-res-test2")).isEmpty());
  }
}
