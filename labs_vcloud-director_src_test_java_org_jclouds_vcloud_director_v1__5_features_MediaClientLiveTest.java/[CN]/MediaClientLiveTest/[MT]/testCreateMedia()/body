{
  assertNotNull(vdcURI,String.format(REF_REQ_LIVE,VDC));
  Vdc vdc=vdcClient.getVdc(vdcURI);
  assertNotNull(vdc,String.format(OBJ_REQ_LIVE,VDC));
  Link addMedia=find(vdc.getLinks(),and(relEquals("add"),typeEquals(VCloudDirectorMediaType.MEDIA)));
  byte[] iso=new byte[]{0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15};
  Media sourceMedia=Media.builder().type(VCloudDirectorMediaType.MEDIA).name("Test media 1").size(iso.length).imageType(Media.ImageType.ISO).description("Test media generated by testCreateMedia()").build();
  media=mediaClient.createMedia(addMedia.getHref(),sourceMedia);
  Checks.checkMediaFor(MEDIA,media);
  assertNotNull(media.getFiles(),String.format(OBJ_FIELD_REQ,MEDIA,"files"));
  assertTrue(media.getFiles().size() == 1,String.format(OBJ_FIELD_EQ,MEDIA,"files.size()","1",media.getFiles().size()));
  File uploadFile=getFirst(media.getFiles(),null);
  assertNotNull(uploadFile,String.format(OBJ_FIELD_REQ,MEDIA,"files.first"));
  assertTrue(equal(uploadFile.getSize(),sourceMedia.getSize()),String.format(OBJ_FIELD_EQ,MEDIA,"uploadFile.size()",sourceMedia.getSize(),uploadFile.getSize()));
  Set<Link> links=uploadFile.getLinks();
  assertNotNull(links,String.format(OBJ_FIELD_REQ,MEDIA,"uploadFile.links"));
  assertTrue(links.size() == 1,String.format(OBJ_FIELD_EQ,MEDIA,"uploadfile.links.size()","1",links.size()));
  Link uploadLink=getFirst(links,null);
  assertTrue(equal(uploadLink.getRel(),Link.Rel.UPLOAD_DEFAULT),String.format(OBJ_FIELD_REQ,MEDIA,"uploadFile.links.first"));
  context.getApi().getUploadClient().upload(uploadLink.getHref(),Payloads.newByteArrayPayload(iso));
  media=mediaClient.getMedia(media.getHref());
  Task task=Iterables.getOnlyElement(media.getTasks());
  assertEquals(task.getStatus(),"running");
  File file=Iterables.getOnlyElement(media.getFiles());
  assertEquals(file.getSize(),new Long(iso.length));
  assertEquals(file.getBytesTransferred(),new Long(iso.length));
}
