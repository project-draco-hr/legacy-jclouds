{
  if (vApp.getStatus() != Status.OFF) {
    logger.debug(">> undeploying vApp(%s), current status: %s",vApp.getName(),vApp.getStatus());
    try {
      waitForTask(client.getVAppClient().undeployVApp(vApp.getHref()),vApp);
      vApp=client.getVAppClient().getVApp(vApp.getHref());
      logger.debug("<< %s vApp(%s)",vApp.getStatus(),vApp.getName());
    }
 catch (    IllegalStateException e) {
      logger.warn(e,"<< %s vApp(%s)",vApp.getStatus(),vApp.getName());
    }
  }
  return vApp;
}
