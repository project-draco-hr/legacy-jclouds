{
  ISession session=manager.getSessionObject();
  IMachine machine=manager.getVBox().findMachine(vmName);
  machine.lockMachine(session,LockType.Write);
  IMachine mutable=session.getMachine();
  mutable.getNetworkAdapter(new Long(0)).getNatDriver().removeRedirect("guestssh");
  mutable.detachDevice(controller,0,0);
  mutable.saveSettings();
  session.unlockMachine();
  for (  IStorageController storageController : machine.getStorageControllers()) {
    if (storageController.getName().equals(controller)) {
      session=manager.getSessionObject();
      machine.lockMachine(session,LockType.Write);
      mutable=session.getMachine();
      mutable.detachDevice(storageController.getName(),1,1);
      mutable.saveSettings();
      session.unlockMachine();
    }
  }
}
