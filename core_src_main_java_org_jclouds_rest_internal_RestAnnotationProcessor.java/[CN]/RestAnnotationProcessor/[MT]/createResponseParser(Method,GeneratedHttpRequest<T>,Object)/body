{
  Function<HttpResponse,?> transformer;
  Class<? extends HandlerWithResult<?>> handler=getXMLTransformerOrNull(method);
  if (handler != null) {
    transformer=parserFactory.create(injector.getInstance(handler));
  }
 else {
    transformer=injector.getInstance(getParserOrThrowException(method));
  }
  if (transformer instanceof InvocationContext) {
    ((InvocationContext)transformer).setContext(request);
  }
  return transformer;
}
