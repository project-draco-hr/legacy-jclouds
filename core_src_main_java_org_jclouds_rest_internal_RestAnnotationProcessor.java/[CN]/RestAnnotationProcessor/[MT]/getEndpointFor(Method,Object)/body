{
  URI endpoint=getEndpointInParametersOrNull(method,args);
  if (endpoint == null) {
    Endpoint annotation;
    if (method.isAnnotationPresent(Endpoint.class)) {
      annotation=method.getAnnotation(Endpoint.class);
      checkState(annotation.value() != Endpoint.NONE.class,String.format("@Endpoint annotation at method %s must have a value() of valid Qualifier",method));
    }
 else     if (declaring.isAnnotationPresent(Endpoint.class)) {
      annotation=declaring.getAnnotation(Endpoint.class);
      checkState(annotation.value() != Endpoint.NONE.class,String.format("@Endpoint annotation at type %s must have a value() of valid Qualifier",declaring));
    }
 else {
      throw new IllegalStateException("There must be an @Endpoint annotation on parameter, method or type: " + method);
    }
    return injector.getInstance(Key.get(URI.class,annotation.value()));
  }
  return endpoint;
}
