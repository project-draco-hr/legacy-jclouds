{
  URI endpoint=getEndpointInParametersOrNull(method,args,injector);
  if (endpoint == null) {
    Endpoint annotation;
    if (method.isAnnotationPresent(Endpoint.class)) {
      annotation=method.getAnnotation(Endpoint.class);
    }
 else     if (method.getDeclaringClass().isAnnotationPresent(Endpoint.class)) {
      annotation=method.getDeclaringClass().getAnnotation(Endpoint.class);
    }
 else {
      throw new IllegalStateException("no annotations on class or method: " + method);
    }
    endpoint=injector.getInstance(Key.get(uriSupplierLiteral,annotation.value())).get();
  }
  URI providerEndpoint=injector.getInstance(Key.get(uriSupplierLiteral,org.jclouds.location.Provider.class)).get();
  return addHostIfMissing(endpoint,providerEndpoint);
}
