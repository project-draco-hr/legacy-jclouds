{
  Optional<Long> defaultMillis=fromNullable(timeouts.get("default"));
  Optional<Long> timeoutMillis;
  if (invoked.isAnnotationPresent(Named.class)) {
    String commandName=invoked.getAnnotation(Named.class).value();
    timeoutMillis=fromNullable(timeouts.get(commandName)).or(defaultMillis);
  }
 else {
    String className=invoked.getOwnerType().getRawType().getSimpleName().replace("AsyncClient","Client").replace("AsyncApi","Api");
    timeoutMillis=fromNullable(timeouts.get(className + "." + invoked.getName())).or(fromNullable(timeouts.get(className))).or(defaultMillis);
  }
  if (timeoutMillis.isPresent())   return Optional.of(TimeUnit.MILLISECONDS.toNanos(timeoutMillis.get()));
  return Optional.absent();
}
