{
  checkArgument(imageCatalogIdMap.containsKey(image),"image not configured: " + image);
  String templateId=imageCatalogIdMap.get(image);
  logger.debug(">> instantiating vApp name(%s) minCores(%d) minMegs(%d) template(%s)",name,minCores,minMegs,templateId);
  HostingDotComVApp vAppResponse=(HostingDotComVApp)tmClient.instantiateVAppTemplate(name,templateId,InstantiateVAppTemplateOptions.Builder.cpuCount(minCores).megabytes(minMegs));
  logger.debug("<< instantiated VApp(%s)",vAppResponse.getId());
  logger.debug(">> deploying vApp(%s)",vAppResponse.getId());
  VApp vApp=blockUntilVAppStatusOrThrowException(vAppResponse,tmClient.deployVApp(vAppResponse.getId()),"deploy",VAppStatus.ON);
  logger.debug("<< on vApp(%s)",vApp.getId());
  return ImmutableMap.<String,String>of("id",vApp.getId(),"username",vAppResponse.getUsername(),"password",vAppResponse.getPassword());
}
