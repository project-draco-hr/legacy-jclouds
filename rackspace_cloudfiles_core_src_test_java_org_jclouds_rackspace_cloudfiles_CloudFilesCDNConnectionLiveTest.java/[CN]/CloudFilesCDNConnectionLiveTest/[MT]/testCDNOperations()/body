{
  final long minimumTTL=60 * 60;
  final String containerNameWithCDN=bucketPrefix + ".testCDNOperationsContainerWithCDN";
  final String containerNameWithoutCDN=bucketPrefix + ".testCDNOperationsContainerWithoutCDN";
  assertTrue(filesConnection.putContainer(containerNameWithCDN));
  assertTrue(filesConnection.putContainer(containerNameWithoutCDN));
  ContainerCDNMetadata cdnMetadata=null;
  final String cdnUri=cdnConnection.enableCDN(containerNameWithCDN);
  assertTrue(cdnUri != null);
  assertTrue(cdnUri.startsWith("http://"));
  cdnMetadata=cdnConnection.getCDNMetadata(containerNameWithCDN);
  assertTrue(cdnMetadata.isCdnEnabled());
  assertEquals(cdnMetadata.getCdnUri(),cdnUri);
  final long initialTTL=cdnMetadata.getTtl();
  cdnMetadata=cdnConnection.getCDNMetadata(containerNameWithoutCDN);
  assertEquals(cdnMetadata,ContainerCDNMetadata.NOT_FOUND);
  cdnMetadata=cdnConnection.getCDNMetadata("DoesNotExist");
  assertEquals(cdnMetadata,ContainerCDNMetadata.NOT_FOUND);
  List<ContainerCDNMetadata> cdnMetadataList=cdnConnection.listCDNContainers();
  assertTrue(Iterables.any(cdnMetadataList,new Predicate<ContainerCDNMetadata>(){
    public boolean apply(    ContainerCDNMetadata cdnMetadata){
      return (cdnMetadata.getName().equals(containerNameWithCDN) && cdnMetadata.isCdnEnabled() && cdnMetadata.getTtl() == initialTTL && cdnMetadata.getCdnUri().equals(cdnUri));
    }
  }
));
  long ttl=4000;
  cdnConnection.enableCDN(containerNameWithCDN,ttl);
  cdnMetadata=cdnConnection.getCDNMetadata(containerNameWithCDN);
  assertTrue(cdnMetadata.isCdnEnabled());
  assertEquals(cdnMetadata.getTtl(),ttl);
  ttl=minimumTTL;
  cdnConnection.updateCDN(containerNameWithCDN,minimumTTL);
  cdnMetadata=cdnConnection.getCDNMetadata(containerNameWithCDN);
  assertTrue(cdnMetadata.isCdnEnabled());
  assertEquals(cdnMetadata.getTtl(),minimumTTL);
  cdnConnection.updateCDN(containerNameWithCDN,3599L);
  cdnMetadata=cdnConnection.getCDNMetadata(containerNameWithCDN);
  assertEquals(cdnMetadata.getTtl(),minimumTTL);
  assertTrue(cdnConnection.disableCDN(containerNameWithCDN));
  cdnMetadata=cdnConnection.getCDNMetadata(containerNameWithCDN);
  assertEquals(cdnMetadata.isCdnEnabled(),false);
  assertTrue(filesConnection.deleteContainerIfEmpty(containerNameWithCDN));
  assertTrue(filesConnection.deleteContainerIfEmpty(containerNameWithoutCDN));
}
