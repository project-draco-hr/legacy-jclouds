{
  Payload payload=Payloads.newByteArrayPayload(new byte[]{});
  payload.getContentMetadata().setContentType("application/vnd.abiquo.racks+xml;version=1.8.5");
  Multimap<String,String> headers=LinkedHashMultimap.<String,String>create();
  headers.put(HttpHeaders.ACCEPT,"application/vnd.abiquo.racks+xml");
  HttpRequest request=HttpRequest.builder().method("GET").endpoint(URI.create("http://foo")).headers(headers).payload(payload).build();
  AppendApiVersionToMediaType filter=new AppendApiVersionToMediaType(new AppendApiVersionToAbiquoMimeType(AbiquoAsyncApi.API_VERSION));
  HttpRequest filtered=filter.filter(request);
  Collection<String> accept=filtered.getHeaders().get(HttpHeaders.ACCEPT);
  assertEquals(accept.size(),1);
  assertEquals(accept.iterator().next(),"application/vnd.abiquo.racks+xml;version=" + AbiquoAsyncApi.API_VERSION);
  assertEquals(filtered.getPayload().getContentMetadata().getContentType(),"application/vnd.abiquo.racks+xml;version=1.8.5");
}
