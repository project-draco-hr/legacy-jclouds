{
  container=getRequiredSystemProperty(PROPERTY_TWEETSTORE_CONTAINER);
  props.setProperty(PROPERTY_TWEETSTORE_CONTAINER,container);
  props.setProperty(SpringServletConfig.PROPERTY_BLOBSTORE_CONTEXTS,Joiner.on(',').join(blobstores));
  addCredentialsForBlobStores(props);
  addConfigurationForTwitter(props);
  final BlobStoreContextFactory factory=new BlobStoreContextFactory();
  final Set<Module> wiring=ImmutableSet.<Module>of(new Log4JLoggingModule());
  this.contexts=Maps.newConcurrentMap();
  for (  String provider : blobstores) {
    contexts.put(provider,factory.createContext(provider,wiring,props));
  }
  Configuration conf=new ConfigurationBuilder().setOAuthConsumerKey(props.getProperty(TwitterConstants.PROPERTY_TWITTER_CONSUMER_KEY)).setOAuthConsumerSecret(props.getProperty(TwitterConstants.PROPERTY_TWITTER_CONSUMER_SECRET)).setOAuthAccessToken(props.getProperty(TwitterConstants.PROPERTY_TWITTER_ACCESSTOKEN)).setOAuthAccessTokenSecret(props.getProperty(TwitterConstants.PROPERTY_TWITTER_ACCESSTOKEN_SECRET)).build();
  Twitter client=new TwitterFactory(conf).getInstance();
  StoreTweetsController controller=new StoreTweetsController(contexts,container,client);
  ResponseList<Status> statuses=client.getMentions();
  boolean deleted=false;
  for (  BlobStoreContext context : contexts.values()) {
    if (context.getBlobStore().containerExists(container)) {
      System.err.printf("deleting container %s at %s%n",container,context.getProviderSpecificContext().getEndpoint());
      context.getBlobStore().deleteContainer(container);
      deleted=true;
    }
  }
  if (deleted) {
    System.err.println("sleeping 60 seconds to allow containers to clear");
    Thread.sleep(60000);
  }
  for (  BlobStoreContext context : contexts.values()) {
    System.err.printf("creating container %s at %s%n",container,context.getProviderSpecificContext().getEndpoint());
    context.getBlobStore().createContainerInLocation(null,container);
  }
  if (deleted) {
    System.err.println("sleeping 5 seconds to allow containers to create");
    Thread.sleep(5000);
  }
  for (  Entry<String,BlobStoreContext> entry : contexts.entrySet()) {
    System.err.printf("filling container %s at %s%n",container,entry.getKey());
    controller.addMyTweets(entry.getKey(),statuses);
  }
}
