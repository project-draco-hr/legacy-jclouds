{
  for (  String zoneId : novaContext.getApi().getConfiguredZones()) {
    Optional<? extends FloatingIPApi> apiOption=novaContext.getApi().getFloatingIPExtensionForZone(zoneId);
    if (!apiOption.isPresent())     continue;
    FloatingIPApi api=apiOption.get();
    FloatingIP floatingIP=api.allocate();
    assertNotNull(floatingIP);
    Set<? extends FloatingIP> response=api.list().toImmutableSet();
    boolean ipInSet=false;
    for (    FloatingIP ip : response) {
      if (ip.getId().equals(floatingIP.getId()))       ipInSet=true;
    }
    assertTrue(ipInSet);
    api.deallocate(floatingIP.getId());
    response=api.list().toImmutableSet();
    ipInSet=false;
    for (    FloatingIP ip : response) {
      if (ip.getId().equals(floatingIP.getId())) {
        ipInSet=true;
      }
    }
    assertFalse(ipInSet);
  }
}
