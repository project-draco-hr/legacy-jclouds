{
  Credentials expected=new Credentials("ubuntu","password");
  Image image=createMock(Image.class);
  Template template=createMock(Template.class);
  expect(template.getImage()).andReturn(image);
  expect(image.getDefaultCredentials()).andReturn(new LoginCredentials("user","password",null,false));
  expect(template.getOptions()).andReturn(TemplateOptions.Builder.overrideLoginUser("ubuntu"));
  replay(template);
  replay(image);
  assertEquals(fn.apply(template,new LoginCredentials("foo","bar",null,false)),expected);
  verify(template);
  verify(image);
}
