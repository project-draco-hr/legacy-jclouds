{
  Set<NodeMetadata> nodes=Sets.newHashSet();
  for (  String org : orgNameToEndpoint.get().keySet()) {
    for (    NamedResource vdc : client.findOrganizationNamed(org).getVDCs().values()) {
      for (      NamedResource resource : client.getVDC(vdc.getLocation()).getResourceEntities().values()) {
        if (validVApp(resource) && filter.apply(convertVAppToComputeMetadata(vdc,resource))) {
          addVAppToSetRetryingIfNotYetPresent(nodes,vdc,resource);
        }
      }
    }
  }
  return nodes;
}
