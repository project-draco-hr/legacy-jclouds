{
  final ByteArrayOutputStream out=new ByteArrayOutputStream();
  return com.google.common.io.ByteStreams.readBytes(supplier,new ByteProcessor<byte[]>(){
    int currentPos=0;
    public boolean processBytes(    byte[] buf,    int off,    int len){
      try {
        if (currentPos == 0 && new String(Arrays.copyOfRange(buf,off,2),"ASCII").equals("0x")) {
          off+=2;
        }
        byte[] decoded=hex(new String(Arrays.copyOfRange(buf,off,len),"ASCII"));
        out.write(decoded,0,decoded.length);
        currentPos+=len;
      }
 catch (      UnsupportedEncodingException e) {
        throw new IllegalStateException("ASCII must be supported");
      }
      return true;
    }
    public byte[] getResult(){
      return out.toByteArray();
    }
  }
);
}
