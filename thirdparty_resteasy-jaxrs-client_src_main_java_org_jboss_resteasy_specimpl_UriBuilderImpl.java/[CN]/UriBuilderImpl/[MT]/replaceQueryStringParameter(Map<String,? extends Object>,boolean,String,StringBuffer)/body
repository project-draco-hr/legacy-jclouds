{
  Matcher matcher=createUriParamMatcher(string);
  while (matcher.find()) {
    String param=matcher.group(1);
    String value=paramMap.get(param).toString();
    if (value != null) {
      if (!isEncoded) {
        value=Encode.encodeQueryStringNameOrValue(value);
      }
      matcher.appendReplacement(buffer,value);
    }
 else {
      throw new IllegalArgumentException("path param " + param + " has not been provided by the parameter map");
    }
  }
  matcher.appendTail(buffer);
  return buffer;
}
