{
  if (!bucketToContents.containsKey(bucketName)) {
    new RuntimeException("bucketName not found: " + bucketName);
  }
  try {
    S3Object.Metadata newMd=copy(object.getMetadata());
    newMd.setLastModified(new DateTime());
    byte[] data=toByteArray(object.getData());
    final byte[] md5=S3Utils.md5(data);
    newMd.setMd5(md5);
    newMd.setContentType("binary/octet-stream");
    if (options.getAcl() != null)     keyToAcl.put(bucketName + object,options.getAcl());
    bucketToContents.get(bucketName).put(object.getKey(),new S3Object(newMd,data));
    return new FutureBase<byte[]>(){
      public byte[] get() throws InterruptedException, ExecutionException {
        return md5;
      }
    }
;
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
