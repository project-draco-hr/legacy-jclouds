{
  ISession session=manager.getSessionObject();
  try {
    IMachine immutableMachine=manager.getVBox().findMachine(machineId);
    SessionState state=immutableMachine.getSessionState();
    Statement kill=newStatementList(call("default"),findPid(immutableMachine.getSessionPid().toString()),kill());
    if (state.equals(SessionState.Locked))     kill.render(OsFamily.UNIX);
    return function.apply(immutableMachine);
  }
 catch (  VBoxException e) {
    session.unlockMachine();
    throw new RuntimeException(String.format("error applying %s to %s: %s",function,machineId,e.getMessage()),e);
  }
}
