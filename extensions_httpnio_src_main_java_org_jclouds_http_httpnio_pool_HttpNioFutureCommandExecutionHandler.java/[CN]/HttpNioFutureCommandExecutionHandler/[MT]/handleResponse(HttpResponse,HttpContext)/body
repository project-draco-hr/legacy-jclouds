{
  HttpNioFutureCommandConnectionHandle handle=(HttpNioFutureCommandConnectionHandle)context.removeAttribute("command-handle");
  if (handle != null) {
    try {
      HttpFutureCommand<?> command=handle.getCommand();
      org.jclouds.http.HttpResponse response=HttpNioUtils.convertToJavaCloudsResponse(apacheResponse);
      int code=response.getStatusCode();
      if (code >= 500) {
        if (isRetryable(command)) {
          commandQueue.add(command);
        }
 else {
          this.serverErrorHandler.handle(command,response);
        }
      }
 else       if (code >= 400 && code < 500) {
        this.clientErrorHandler.handle(command,response);
      }
 else       if (code >= 300 && code < 400) {
        this.redirectHandler.handle(command,response);
      }
 else {
        processResponse(response,command);
      }
    }
  finally {
      releaseConnectionToPool(handle);
    }
  }
 else {
    throw new IllegalStateException(String.format("No command-handle associated with command %1s",context));
  }
}
