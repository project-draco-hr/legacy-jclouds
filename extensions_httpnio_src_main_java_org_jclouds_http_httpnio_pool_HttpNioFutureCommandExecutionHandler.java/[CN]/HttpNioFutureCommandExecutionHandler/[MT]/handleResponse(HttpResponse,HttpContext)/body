{
  HttpNioFutureCommandConnectionHandle handle=(HttpNioFutureCommandConnectionHandle)context.removeAttribute("command-handle");
  if (handle != null) {
    try {
      HttpFutureCommand<?> command=handle.getCommand();
      org.jclouds.http.HttpResponse response=HttpNioUtils.convertToJavaCloudsResponse(apacheResponse);
      int statusCode=response.getStatusCode();
      if (statusCode >= 300) {
        if (retryHandler.shouldRetryRequest(command,response)) {
          resubmitQueue.add(command);
        }
 else {
          errorHandler.handleError(command,response);
        }
      }
 else {
        processResponse(response,command);
      }
    }
  finally {
      releaseConnectionToPool(handle);
    }
  }
 else {
    throw new IllegalStateException(String.format("No command-handle associated with command %1$s",context));
  }
}
