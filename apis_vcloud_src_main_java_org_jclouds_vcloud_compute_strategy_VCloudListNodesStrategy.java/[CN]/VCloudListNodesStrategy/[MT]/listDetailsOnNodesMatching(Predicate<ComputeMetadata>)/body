{
  Builder<NodeMetadata> nodes=ImmutableSet.<NodeMetadata>builder();
  for (  Org org : nameToOrg.get().values()) {
    for (    ReferenceType vdc : org.getVDCs().values()) {
      for (      ReferenceType resource : client.getVDCClient().getVDC(vdc.getHref()).getResourceEntities().values()) {
        if (validVApp(resource) && filter.apply(convertVAppToComputeMetadata(vdc,resource))) {
          addVAppToSetRetryingIfNotYetPresent(nodes,vdc,resource);
        }
      }
    }
  }
  return nodes.build();
}
