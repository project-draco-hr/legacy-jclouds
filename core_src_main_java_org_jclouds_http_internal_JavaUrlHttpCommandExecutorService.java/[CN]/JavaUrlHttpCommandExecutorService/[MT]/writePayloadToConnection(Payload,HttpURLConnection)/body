{
  Long length=payload.getContentMetadata().getContentLength();
  connection.setFixedLengthStreamingMode(length.intValue());
  connection.setDoOutput(true);
  connection.setRequestProperty("Expect","100-continue");
  CountingOutputStream out=new CountingOutputStream(connection.getOutputStream());
  try {
    payload.writeTo(out);
  }
 catch (  IOException e) {
    logger.error(e,"error after writing %d/%s bytes to %s",out.getCount(),length,connection.getURL());
    throw e;
  }
}
