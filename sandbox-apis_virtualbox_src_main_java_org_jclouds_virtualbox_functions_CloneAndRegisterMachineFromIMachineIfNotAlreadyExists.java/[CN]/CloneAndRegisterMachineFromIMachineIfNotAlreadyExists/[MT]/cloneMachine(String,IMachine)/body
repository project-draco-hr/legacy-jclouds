{
  IMachine clonedMachine=manager.getVBox().createMachine(settingsFile,cloneName,osTypeId,vmId,forceOverwrite);
  List<CloneOptions> options=new ArrayList<CloneOptions>();
  options.add(CloneOptions.Link);
  ISnapshot currentSnapshot=new TakeSnapshotIfNotAlreadyAttached(manager,snapshotName,snapshotDesc).apply(master);
  IProgress progress=currentSnapshot.getMachine().cloneTo(clonedMachine,CloneMode.MachineState,options);
  if (progress.getCompleted())   logger.debug("clone done");
  manager.getVBox().registerMachine(clonedMachine);
  List<String> activeBridgedInterfaces=new RetrieveActiveBridgedInterfaces(context).apply(hostId);
  checkNotNull(activeBridgedInterfaces);
  String macAddress=manager.getVBox().getHost().generateMACAddress();
  String bridgedInterface=activeBridgedInterfaces.get(0);
  long adapterSlot=0l;
  ensureBridgedNetworkingIsAppliedToMachine(adapterSlot,cloneName,macAddress,bridgedInterface);
  int controllerPort=0;
  int device=0;
  ensureMachineHasDistroMediumDetached(cloneName,controllerIDE,controllerPort,device);
  return clonedMachine;
}
