{
  String keyPairName=null;
  boolean shouldAutomaticallyCreateKeyPair=true;
  if (options instanceof EC2TemplateOptions) {
    keyPairName=EC2TemplateOptions.class.cast(options).getKeyPair();
    if (keyPairName == null)     shouldAutomaticallyCreateKeyPair=EC2TemplateOptions.class.cast(options).shouldAutomaticallyCreateKeyPair();
  }
  if (keyPairName == null && shouldAutomaticallyCreateKeyPair) {
    keyPairName=createOrImportKeyPair(region,group,options);
  }
  return keyPairName;
}
