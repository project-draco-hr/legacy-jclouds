{
  Builder<VM> builder=ImmutableSet.builder();
  for (  Resource org1 : api.listOrgs()) {
    Org org=api.getBrowsingApi().getOrg(org1.getId());
    for (    Resource vdc : org.getVDCs()) {
      VDC VDC=api.getBrowsingApi().getVDCInOrg(org.getId(),vdc.getId());
      for (      Resource vApp : Iterables.filter(VDC.getResourceEntities(),new Predicate<Resource>(){
        @Override public boolean apply(        Resource arg0){
          return VCloudMediaType.VAPP_XML.equals(arg0.getType());
        }
      }
)) {
        builder.add(api.getBrowsingApi().getVMInVDC(org.getId(),vdc.getId(),vApp.getId(),withPowerState()));
      }
    }
  }
  return builder.build();
}
