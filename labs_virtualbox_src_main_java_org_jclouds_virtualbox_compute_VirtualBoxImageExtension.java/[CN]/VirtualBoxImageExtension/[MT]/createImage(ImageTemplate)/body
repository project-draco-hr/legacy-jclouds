{
  checkState(template instanceof CloneImageTemplate," vbox image extension only supports cloning for the moment.");
  CloneImageTemplate cloneTemplate=CloneImageTemplate.class.cast(template);
  IMachine source=manager.get().getVBox().findMachine(cloneTemplate.getSourceNodeId());
  String settingsFile=manager.get().getVBox().composeMachineFilename(template.getName(),workingDir);
  IMachine clonedMachine=manager.get().getVBox().createMachine(settingsFile,template.getName(),source.getOSTypeId(),template.getName(),true);
  List<CloneOptions> options=new ArrayList<CloneOptions>();
  if (isLinkedClone)   options.add(CloneOptions.Link);
  ISnapshot currentSnapshot=new TakeSnapshotIfNotAlreadyAttached(manager,"pre-image-spawn","before spawning " + template.getName(),logger).apply(source);
  checkNotNull(currentSnapshot);
  IProgress progress=currentSnapshot.getMachine().cloneTo(clonedMachine,CloneMode.MachineState,options);
  progress.waitForCompletion(-1);
  logger.debug(String.format("Machine %s is cloned correctly",clonedMachine.getName()));
  manager.get().getVBox().registerMachine(clonedMachine);
  return Futures.immediateFuture(imachineToImage.apply(clonedMachine));
}
