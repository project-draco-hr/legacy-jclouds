{
  checkState(data != null,"data");
  if (data instanceof InputStream) {
    ETagInputStreamResult result=HttpUtils.generateETagResult((InputStream)data);
    getMetadata().setSize(result.length);
    getMetadata().setETag(result.eTag);
    setData(result.data);
  }
 else {
    getMetadata().setETag(HttpUtils.eTag(data));
  }
}
