{
  checkNotNull(keyParts,"keyParts");
  checkArgument(keyParts.size() >= 1,"keyParts must contain at least one element");
  checkNotNull(toInsert,"toInsert");
  checkNotNull(destination,"destination");
  String rootKey=keyParts.remove(0);
  String rootValue=destination.containsKey(rootKey) ? destination.get(rootKey).toString() : "{}";
  checkArgument(rootValue.matches("^\\{.*\\}$"),"value must be a hash: %s",rootValue);
  Map<String,JsonBall> insertionContext=json.fromJson(rootValue,mapLiteral);
  if (keyParts.size() == 1) {
    if (!insertionContext.containsKey(keyParts.get(0))) {
      insertionContext.put(keyParts.get(0),toInsert);
    }
 else {
      String key=keyParts.get(0);
      mergeAsPeer(key,toInsert,insertionContext);
    }
  }
 else {
    putUnderContext(keyParts,toInsert,insertionContext);
  }
  destination.put(rootKey,new JsonBall(json.toJson(insertionContext,mapLiteral)));
}
