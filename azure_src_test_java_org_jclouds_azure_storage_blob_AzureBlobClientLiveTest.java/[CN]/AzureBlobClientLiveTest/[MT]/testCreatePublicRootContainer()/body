{
  try {
    connection.deleteRootContainer().get(10,TimeUnit.SECONDS);
  }
 catch (  ExecutionException e) {
    sleepIfWaitingForDeleteToFinish(e);
  }
  boolean created=false;
  while (!created) {
    try {
      created=connection.createRootContainer().get(10,TimeUnit.SECONDS);
    }
 catch (    ExecutionException e) {
      AzureStorageResponseException htpe=(AzureStorageResponseException)e.getCause().getCause();
      if (htpe.getResponse().getStatusCode() == 409) {
        Thread.sleep(5000);
        continue;
      }
      throw e;
    }
  }
  ListBlobsResponse list=connection.listBlobs().get(10,TimeUnit.SECONDS);
  assertEquals(list.getUrl(),URI.create(String.format("https://%s.blob.core.windows.net/%%24root",account)));
}
