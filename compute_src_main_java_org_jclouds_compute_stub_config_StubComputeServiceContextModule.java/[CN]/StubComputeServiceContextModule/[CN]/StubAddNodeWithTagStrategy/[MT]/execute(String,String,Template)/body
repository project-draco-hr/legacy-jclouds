{
  checkArgument(location.get().equals(template.getLocation()),"invalid location: " + template.getLocation());
  int id=idProvider.get();
  StubNodeMetadata node=new StubNodeMetadata(id + "",name,id + "",location.get(),null,ImmutableMap.<String,String>of(),tag,template.getImage().getId(),template.getImage(),template.getImage().getOperatingSystem(),NodeState.PENDING,ImmutableSet.<String>of(publicIpPrefix + id),ImmutableSet.<String>of(privateIpPrefix + id),ImmutableMap.<String,String>of(),new Credentials("root",passwordPrefix + id),service);
  nodes.put(id,node);
  node.setState(NodeState.RUNNING,100);
  return node;
}
