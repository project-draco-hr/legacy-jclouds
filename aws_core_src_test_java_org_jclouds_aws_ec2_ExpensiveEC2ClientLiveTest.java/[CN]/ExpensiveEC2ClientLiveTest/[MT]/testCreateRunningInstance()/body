{
  String imageId="ami-1fd73376";
  RunningInstance server=null;
  while (server == null) {
    try {
      server=client.runInstances(imageId,1,1,withKeyName(keyPair.getKeyName()).asType(InstanceType.M1_SMALL).withSecurityGroup(securityGroupName)).get(30,TimeUnit.SECONDS).getRunningInstances().iterator().next();
    }
 catch (    UndeclaredThrowableException e) {
      HttpResponseException htpe=(HttpResponseException)e.getCause().getCause();
      if (htpe.getResponse().getStatusCode() == 400)       continue;
      throw e;
    }
  }
  assertNotNull(server.getInstanceId());
  serverId=server.getInstanceId();
  assertEquals(server.getInstanceState(),InstanceState.PENDING);
  server=blockUntilRunningInstanceActive(serverId);
  sshPing(server);
}
