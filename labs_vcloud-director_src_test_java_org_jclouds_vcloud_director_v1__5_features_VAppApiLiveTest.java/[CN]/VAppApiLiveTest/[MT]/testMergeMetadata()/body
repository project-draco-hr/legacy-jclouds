{
  Metadata oldMetadata=vAppApi.getMetadataApi(vAppUrn).get();
  Map<String,String> oldMetadataMap=Checks.metadataToMap(oldMetadata);
  String key=name("key-");
  String value=name("value-");
  Task task=vAppApi.getMetadataApi(vAppUrn).putAll(ImmutableMap.of(key,value));
  retryTaskSuccess.apply(task);
  Metadata newMetadata=vAppApi.getMetadataApi(vAppUrn).get();
  Map<String,String> expectedMetadataMap=ImmutableMap.<String,String>builder().putAll(oldMetadataMap).put(key,value).build();
  checkMetadataFor(VAPP,newMetadata,expectedMetadataMap);
}
