{
  if (isVhostStyle) {
    request=bindAsHostPrefix.bindToRequest(request,payload);
    return ModifyRequest.replaceHeader(request,HttpHeaders.HOST,request.getEndpoint().getHost());
  }
 else {
    UriBuilder builder=uriBuilderProvider.get().uri(request.getEndpoint());
    StringBuilder path=new StringBuilder(Strings2.urlEncode(request.getEndpoint().getPath(),S3AsyncClient.class.getAnnotation(SkipEncoding.class).value()));
    int indexToInsert=0;
    if (!servicePath.equals("/")) {
      indexToInsert=path.indexOf(servicePath);
      indexToInsert=indexToInsert == -1 ? 0 : indexToInsert;
      indexToInsert+=servicePath.length();
    }
    path.insert(indexToInsert,"/" + payload.toString());
    builder.replacePath(path.toString());
    return (R)request.toBuilder().endpoint(builder.buildFromEncodedMap(ImmutableMap.<String,Object>of())).build();
  }
}
