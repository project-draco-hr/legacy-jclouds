{
  HttpRequest listMetricsWithOptions=HttpRequest.builder().method("POST").endpoint(URI.create("https://monitoring.us-east-1.amazonaws.com/")).headers(ImmutableMultimap.<String,String>builder().put("Host","monitoring.us-east-1.amazonaws.com").build()).payload(payloadFromStringWithContentType("Action=ListMetrics" + "&Dimensions.member.1.Name=InstanceId" + "&Dimensions.member.1.Value=SOMEINSTANCEID"+ "&MetricName=CPUUtilization"+ "&Namespace=SOMENEXTTOKEN"+ "&NextToken=AWS%2FEC2"+ "&Signature=G05HKEx9FJpGZBk02OVYwt3u4g%2FilAY9nU5hJI9LDXA%3D"+ "&SignatureMethod=HmacSHA256"+ "&SignatureVersion=2"+ "&Timestamp=2009-11-08T15%3A54%3A08.897Z"+ "&Version=2010-08-01"+ "&AWSAccessKeyId=identity","application/x-www-form-urlencoded")).build();
  HttpResponse listMetricsWithOptionsResponse=HttpResponse.builder().statusCode(200).payload(payloadFromResourceWithContentType("/list_metrics.xml","text/xml")).build();
  CloudWatchClient clientWhenMetricsWithOptionsExist=requestSendsResponse(listMetricsWithOptions,listMetricsWithOptionsResponse);
  assertEquals(clientWhenMetricsWithOptionsExist.getMetricClientForRegion(null).list(ListMetricsOptions.Builder.dimension(new Dimension(EC2Constants.Dimension.INSTANCE_ID,"SOMEINSTANCEID")).metricName(EC2Constants.MetricName.CPU_UTILIZATION).namespace("SOMENEXTTOKEN").nextMarker(Namespaces.EC2)).toString(),"PaginatedSet{contents=[Metric{namespace=AWS/EC2, metricName=CPUUtilization, dimension=[Dimension{name=InstanceId, value=i-689fcf0f}]}], marker=null}");
}
