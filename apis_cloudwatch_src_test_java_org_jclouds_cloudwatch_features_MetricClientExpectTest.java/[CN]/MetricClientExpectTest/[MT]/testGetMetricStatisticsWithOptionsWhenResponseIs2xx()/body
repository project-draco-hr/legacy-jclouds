{
  HttpRequest getMetricStatistics=HttpRequest.builder().method("POST").endpoint(URI.create("https://monitoring.us-east-1.amazonaws.com/")).headers(ImmutableMultimap.<String,String>builder().put("Host","monitoring.us-east-1.amazonaws.com").build()).payload(payloadFromStringWithContentType(new StringBuilder().append("Action=GetMetricStatistics").append('&').append("Dimensions.member.1.Name=InstanceId").append('&').append("Dimensions.member.1.Value=SOMEINSTANCEID").append('&').append("Dimensions.member.2.Name=InstanceType").append('&').append("Dimensions.member.2.Value=t1.micro").append('&').append("EndTime=1970-01-01T02%3A46%3A40Z").append('&').append("MetricName=CPUUtilization").append('&').append("Namespace=AWS%2FEC2").append('&').append("Period=60").append('&').append("Signature=e0WyI%2FNm4hN2%2BMEm1mjRUzsvgvMCdFXbVJWi4ORpwic%3D").append('&').append("SignatureMethod=HmacSHA256").append('&').append("SignatureVersion=2").append('&').append("StartTime=1970-01-01T02%3A46%3A40Z").append('&').append("Statistics.member.1=Maximum").append('&').append("Statistics.member.2=Minimum").append('&').append("Timestamp=2009-11-08T15%3A54%3A08.897Z").append('&').append("Unit=Percent").append('&').append("Version=2010-08-01").append('&').append("AWSAccessKeyId=identity").toString(),"application/x-www-form-urlencoded")).build();
  HttpResponse getMetricStatisticsResponse=HttpResponse.builder().statusCode(200).payload(payloadFromResourceWithContentType("/get_metric_statistics.xml","text/xml")).build();
  CloudWatchClient clientWhenMetricsExist=requestSendsResponse(getMetricStatistics,getMetricStatisticsResponse);
  Dimension dimension1=new Dimension(EC2Constants.Dimension.INSTANCE_ID,"SOMEINSTANCEID");
  Dimension dimension2=new Dimension(EC2Constants.Dimension.INSTANCE_TYPE,"t1.micro");
  assertEquals(clientWhenMetricsExist.getMetricClientForRegion(null).getMetricStatistics(stats,GetMetricStatisticsOptions.Builder.dimension(dimension1).dimension(dimension2)).toString(),"GetMetricStatisticsResponse{label=CPUUtilization, datapoints=[Datapoint{timestamp=Thu Jan 15 16:00:00 PST 2009, customUnit=null, maximum=null, minimum=null, average=0.17777777777777778, sum=null, samples=9.0, unit=Percent}, Datapoint{timestamp=Thu Jan 15 16:01:00 PST 2009, customUnit=null, maximum=null, minimum=null, average=0.1, sum=null, samples=8.0, unit=Percent}]}");
}
