{
  IpDetails added=client.addIpToServer(reservedIp.getAddress(),serverId);
  assertEquals(added.getAddress(),reservedIp.getAddress());
  assertEquals(added.getPtr(),reservedIp.getPtr());
  assertEquals(added.getServerId(),serverId);
  IpDetails again=client.getIp(reservedIp.getAddress());
  assertEquals(again,added);
  IpDetails removed=client.removeIpFromServer(reservedIp.getAddress(),serverId);
  assertEquals(removed,added.toBuilder().serverId(null).build());
  assertEquals(removed,reservedIp);
  Set<String> openVzIps=Sets.newHashSet(client.listFree(4,"Falkenberg","OpenVZ"));
  openVzIps.remove(reservedIp.getAddress());
  assertFalse(openVzIps.isEmpty());
  added=client.addIpToServer(reservedIp.getAddress(),serverId);
  assertEquals(added.getServerId(),serverId);
  removed=client.removeIpFromServerAndRelease(reservedIp.getAddress(),serverId);
  assertNull(removed.getServerId());
  assertFalse(removed.isReserved());
  reserveIp();
}
