{
  checkState(this.sshFactory != null,"runScript requested, but no SshModule configured");
  InetSocketAddress socket=new InetSocketAddress(node.getPublicAddresses().last(),22);
  socketTester.apply(socket);
  SshClient ssh=isKeyAuth(node) ? sshFactory.create(socket,node.getCredentials().account,node.getCredentials().key.getBytes()) : sshFactory.create(socket,node.getCredentials().account,node.getCredentials().key);
  for (int i=0; i < 3; i++) {
    try {
      ssh.connect();
      runScriptOnNodeWithClient(ssh,node,script);
      break;
    }
 catch (    RuntimeException from) {
      if (Iterables.size(Iterables.filter(Throwables.getCausalChain(from),ConnectException.class)) >= 1) {
        try {
          Thread.sleep(100);
        }
 catch (        InterruptedException e) {
          Throwables.propagate(e);
        }
        continue;
      }
      Throwables.propagate(from);
    }
 finally {
      if (ssh != null)       ssh.disconnect();
    }
  }
}
