{
  checkState(this.sshFactory != null,"runScript requested, but no SshModule configured");
  checkNodeHasPublicIps(node);
  checkNotNull(node.getCredentials().key,"credentials.key for node " + node.getProviderId());
  SshClient ssh=createSshClientOncePortIsListeningOnNode(node);
  try {
    ssh.connect();
    return runTasksUsingSshClient(parallel,last,ssh);
  }
  finally {
    if (ssh != null)     ssh.disconnect();
  }
}
