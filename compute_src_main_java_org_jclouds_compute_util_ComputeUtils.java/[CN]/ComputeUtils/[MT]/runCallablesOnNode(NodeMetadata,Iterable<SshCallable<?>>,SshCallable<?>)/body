{
  checkState(this.sshFactory != null,"runScript requested, but no SshModule configured");
  checkNodeHasPublicIps(node);
  checkNotNull(node.getCredentials(),"credentials for node " + node.getName());
  checkNotNull(node.getCredentials().credential,"credentials.credential for node " + node.getName());
  SshClient ssh=createSshClientOncePortIsListeningOnNode(node);
  try {
    ssh.connect();
    return runTasksUsingSshClient(parallel,last,ssh);
  }
  finally {
    if (ssh != null)     ssh.disconnect();
  }
}
