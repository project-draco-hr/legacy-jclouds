{
  ContextBuilder builder=null;
  try {
    ProviderMetadata pm=Providers.withId(providerOrApi);
    builder=ContextBuilder.newBuilder(pm);
  }
 catch (  NoSuchElementException e) {
    builder=ContextBuilder.newBuilder(Apis.withId(providerOrApi));
  }
  builder.modules(Iterable.class.cast(wiring));
  builder.overrides(overrides);
  if (identity != null)   builder.credentials(identity,credential);
  Object context=builder.build();
  if (context instanceof RestContext) {
    return RestContext.class.cast(context);
  }
 else   if (context instanceof View) {
    View tctx=View.class.cast(context);
    return (RestContext<S,A>)tctx.unwrap(TypeToken.of(RestContext.class));
  }
 else {
    throw new IllegalArgumentException("provider " + providerOrApi + " contains an unknown context type: "+ context.getClass().getSimpleName());
  }
}
