{
  Template template=computeService.templateBuilder().from(ebsTemplate).build();
  regionId=template.getLocation().getId();
  Set<? extends NodeMetadata> nodes=computeService.createNodesInGroup("jcloudstest",1,template);
  try {
    String instanceId=Iterables.getOnlyElement(nodes).getProviderId();
    Reservation<? extends RunningInstance> reservation=Iterables.getOnlyElement(view.unwrap(EC2ApiMetadata.CONTEXT_TOKEN).getApi().getInstanceServices().describeInstancesInRegion(regionId,instanceId));
    RunningInstance instance=Iterables.getOnlyElement(reservation);
    BlockDevice device=instance.getEbsBlockDevices().get("/dev/sda1");
    Snapshot snapshot=view.unwrap(EC2ApiMetadata.CONTEXT_TOKEN).getApi().getElasticBlockStoreServices().createSnapshotInRegion(regionId,device.getVolumeId());
    snapshotsToDelete.add(snapshot.getId());
    return snapshot;
  }
  finally {
    computeService.destroyNodesMatching(Predicates.in(nodes));
  }
}
