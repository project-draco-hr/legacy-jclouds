{
  CloudStackClient client=createMock(CloudStackClient.class);
  VirtualMachineClient virtualMachineClient=createMock(VirtualMachineClient.class);
  long virtualMachineId=229;
  VirtualMachine virtualMachine=VirtualMachine.builder().id(virtualMachineId).state(VirtualMachine.State.DESTROYED).build();
  expect(client.getVirtualMachineClient()).andReturn(virtualMachineClient);
  expect(virtualMachineClient.getVirtualMachine(virtualMachineId)).andReturn(virtualMachine);
  replay(client,virtualMachineClient);
  assertTrue(new VirtualMachineDestroyed(client).apply(virtualMachine));
  verify(client,virtualMachineClient);
}
