{
  String hostHeader=request.getFirstHeaderOrNull(HttpHeaders.HOST);
  if (hostHeader == null)   hostHeader=checkNotNull(request.getEndpoint().getHost(),"request.getEndPoint().getHost()");
  if (hostHeader.endsWith(".amazonaws.com") && !hostHeader.equals("s3.amazonaws.com"))   toSign.append("/").append(hostHeader.substring(0,hostHeader.lastIndexOf(".s3")));
}
