{
  final Set<Image> images=Sets.newHashSet();
  holder.logger.debug(">> providing images");
  for (  final Region region : regionMap.keySet()) {
    for (    final org.jclouds.aws.ec2.domain.Image from : sync.getAMIServices().describeImagesInRegion(region,ownedBy(amiOwners))) {
      OsFamily os=null;
      String name=null;
      String osDescription=from.getImageLocation();
      String version="";
      Matcher matcher=ALESTIC_PATTERN.matcher(from.getImageLocation());
      if (matcher.find()) {
        try {
          os=OsFamily.fromValue(matcher.group(1));
          name=matcher.group(2);
          version=matcher.group(3);
        }
 catch (        IllegalArgumentException e) {
          holder.logger.debug("<< didn't match os(%s)",matcher.group(1));
        }
      }
      images.add(new ImageImpl(from.getId(),name,region.toString(),null,ImmutableMap.<String,String>of("owner",from.getImageOwnerId()),from.getDescription(),version,os,osDescription,from.getArchitecture() == org.jclouds.aws.ec2.domain.Image.Architecture.I386 ? Architecture.X86_32 : Architecture.X86_64));
    }
  }
  holder.logger.debug("<< images(%d)",images.size());
  return Maps.uniqueIndex(images,indexer);
}
