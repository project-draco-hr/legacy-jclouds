{
  VirtualBoxManager manager=createNiceMock(VirtualBoxManager.class);
  IVirtualBox vBox=createNiceMock(IVirtualBox.class);
  Supplier<URI> preconfiguration=createNiceMock(Supplier.class);
  String vmName="jclouds-image-my-ubuntu-image";
  IMachine registeredMachine=createMock(IMachine.class);
  expect(manager.getVBox()).andReturn(vBox).anyTimes();
  expect(vBox.findMachine(vmName)).andReturn(registeredMachine).anyTimes();
  replay(manager,vBox);
  VmSpec launchSpecification=VmSpec.builder().id("").name(vmName).osTypeId("").memoryMB(1024).cleanUpMode(CleanupMode.Full).build();
  IMachineSpec machineSpec=IMachineSpec.builder().iso(IsoSpec.builder().sourcePath("some.iso").installationScript("dostuff").preConfiguration(preconfiguration).build()).vm(launchSpecification).network(NetworkSpec.builder().build()).build();
  new CreateAndRegisterMachineFromIsoIfNotAlreadyExists(Suppliers.ofInstance(manager),"/tmp/workingDir").apply(machineSpec);
}
