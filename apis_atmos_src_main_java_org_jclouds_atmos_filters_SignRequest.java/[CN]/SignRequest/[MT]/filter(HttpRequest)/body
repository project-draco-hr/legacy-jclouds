{
  Builder<String,String> builder=ImmutableMap.builder();
  builder.put(AtmosHeaders.UID,uid);
  String date=timeStampProvider.get();
  builder.put(HttpHeaders.DATE,date);
  if (request.getHeaders().containsKey(AtmosHeaders.DATE))   builder.put(AtmosHeaders.DATE,date);
  request=ModifyRequest.replaceHeaders(request,Multimaps.forMap(builder.build()));
  String signature=calculateSignature(createStringToSign(request));
  request=ModifyRequest.replaceHeader(request,AtmosHeaders.SIGNATURE,signature);
  utils.logRequest(signatureLog,request,"<<");
  return request;
}
