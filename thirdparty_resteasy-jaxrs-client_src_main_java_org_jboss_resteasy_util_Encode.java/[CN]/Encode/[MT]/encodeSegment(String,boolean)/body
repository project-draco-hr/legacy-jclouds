{
  ArrayList<String> params=new ArrayList<String>();
  boolean foundParam=false;
  if (ignorePathParams) {
    StringBuffer newSegment=new StringBuffer();
    if (savePathParams(segment,newSegment,params)) {
      foundParam=true;
      segment=newSegment.toString();
    }
  }
  String result;
  try {
    result=URLEncoder.encode(segment,"UTF-8").replace("+","%20").replace("%3B",";").replace("%3D","=").replace("%25","%");
  }
 catch (  UnsupportedEncodingException e) {
    throw new RuntimeException(e);
  }
  segment=result;
  if (ignorePathParams && foundParam) {
    segment=pathParamReplacement(segment,params);
  }
  return segment;
}
