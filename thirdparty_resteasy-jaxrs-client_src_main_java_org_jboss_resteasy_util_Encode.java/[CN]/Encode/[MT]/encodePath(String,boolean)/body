{
  ArrayList<String> params=new ArrayList<String>();
  boolean foundParam=false;
  if (ignorePathParams) {
    StringBuffer newPath=new StringBuffer();
    if (savePathParams(value,newPath,params)) {
      foundParam=true;
      value=newPath.toString();
    }
  }
  String[] segments=value.split("/");
  StringBuilder buffer=new StringBuilder();
  boolean first=true;
  for (  String segment : segments) {
    if (!first) {
      buffer.append("/");
    }
    segment=encodeSegment(segment,ignorePathParams);
    buffer.append(segment);
    first=false;
  }
  String result=buffer.toString();
  if (value.endsWith("/"))   result+="/";
  if (ignorePathParams && foundParam) {
    result=pathParamReplacement(result,params);
  }
  return result;
}
