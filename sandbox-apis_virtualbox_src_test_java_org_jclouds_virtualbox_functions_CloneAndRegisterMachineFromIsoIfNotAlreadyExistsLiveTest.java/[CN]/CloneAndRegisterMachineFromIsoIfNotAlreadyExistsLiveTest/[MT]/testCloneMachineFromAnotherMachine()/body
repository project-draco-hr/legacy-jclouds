{
  VirtualBoxManager manager=(VirtualBoxManager)context.getProviderSpecificContext().getApi();
  ComputeServiceContext localHostContext=computeServiceForLocalhostAndGuest(hostId,"localhost",guestId,"localhost",new Credentials("toor","password"));
  IMachine master=getMasterNode(manager,localHostContext);
  if (master.getCurrentSnapshot() != null) {
    ISession session=manager.openMachineSession(master);
    session.getConsole().deleteSnapshot(master.getCurrentSnapshot().getId());
    session.unlockMachine();
  }
  IMachine clone=new CloneAndRegisterMachineFromIMachineIfNotAlreadyExists(manager,localHostContext,settingsFile,osTypeId,vmId,forceOverwrite,cloneName,hostId,snapshotName,snapshotDesc,controllerIDE).apply(master);
  assertEquals(clone.getNetworkAdapter(0L).getAttachmentType(),Bridged);
}
