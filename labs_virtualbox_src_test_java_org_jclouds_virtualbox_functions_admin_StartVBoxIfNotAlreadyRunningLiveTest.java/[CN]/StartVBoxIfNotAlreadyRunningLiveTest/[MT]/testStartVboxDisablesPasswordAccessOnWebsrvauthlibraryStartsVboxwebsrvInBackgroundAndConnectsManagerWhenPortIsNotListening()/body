{
  VirtualBoxManager manager=createMock(VirtualBoxManager.class);
  Factory runScriptOnNodeFactory=createMock(Factory.class);
  RetryIfSocketNotYetOpen client=createMock(RetryIfSocketNotYetOpen.class);
  RunScriptOnNode runScriptOnNode=createMock(RunScriptOnNode.class);
  NodeMetadata host=new NodeMetadataBuilder().id("host").state(NodeState.RUNNING).operatingSystem(OperatingSystem.builder().description("unix").build()).build();
  URI provider=URI.create("http://localhost:18083/");
  String identity="adminstrator";
  String credential="12345";
  expect(client.seconds(3)).andReturn(client);
  expect(client.apply(new IPSocket(provider.getHost(),provider.getPort()))).andReturn(false);
  expect(runScriptOnNodeFactory.create(host,Statements.exec("VBoxManage setproperty websrvauthlibrary null"),runAsRoot(false).wrapInInitScript(false))).andReturn(runScriptOnNode);
  expect(runScriptOnNode.init()).andReturn(runScriptOnNode);
  expect(runScriptOnNode.call()).andReturn(new ExecResponse("","",0));
  expect(client.apply(new IPSocket(provider.getHost(),provider.getPort()))).andReturn(true);
  expect(runScriptOnNodeFactory.create(host,Statements.exec("vboxwebsrv -t 10000 -v -b"),runAsRoot(false).wrapInInitScript(false).blockOnComplete(false).nameTask("vboxwebsrv"))).andReturn(runScriptOnNode);
  expect(runScriptOnNode.init()).andReturn(runScriptOnNode);
  expect(runScriptOnNode.call()).andReturn(new ExecResponse("","",0));
  manager.connect(provider.toASCIIString(),"","");
  replay(manager,runScriptOnNodeFactory,runScriptOnNode,client);
  new StartVBoxIfNotAlreadyRunning((Function)Functions.constant(manager),runScriptOnNodeFactory,client,Suppliers.ofInstance(host),Suppliers.ofInstance(provider),identity,credential).start();
  verify(manager,runScriptOnNodeFactory,runScriptOnNode,client);
}
