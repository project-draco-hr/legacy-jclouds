{
  String vmName="virtualbox-iso-to-machine-test";
  VirtualBoxManager vbm=createNiceMock(VirtualBoxManager.class);
  IVirtualBox vBox=createNiceMock(IVirtualBox.class);
  IMachine vm=createNiceMock(IMachine.class);
  IMedium hd=createNiceMock(IMedium.class);
  INetworkAdapter iNetworkAdapter=createNiceMock(INetworkAdapter.class);
  INATEngine inatEngine=createNiceMock(INATEngine.class);
  IProgress iProgress=createNiceMock(IProgress.class);
  ISession session=createNiceMock(ISession.class);
  expect(vbm.getVBox()).andReturn(vBox).anyTimes();
  expect(vbm.getSessionObject()).andReturn(session).anyTimes();
  expect(vBox.findMachine(vmName)).andReturn(vm).anyTimes();
  expect(vBox.createMachine(settingsFile,vmName,osTypeId,vmId,forceOverwrite)).andReturn(vm).anyTimes();
  expect(vm.getName()).andReturn(vmName).anyTimes();
  expect(vm.getNetworkAdapter(new Long(0))).andReturn(iNetworkAdapter).anyTimes();
  expect(iNetworkAdapter.getNatDriver()).andReturn(inatEngine).anyTimes();
  expect(vBox.createHardDisk(diskFormat,adminDisk)).andReturn(hd).anyTimes();
  expect(vm.launchVMProcess(session,"gui","")).andReturn(iProgress).anyTimes();
  expect(session.getMachine()).andReturn(vm).anyTimes();
  expect(vm.getState()).andReturn(MachineState.Running).anyTimes();
  replay(vbm,vBox,vm,session,hd,iNetworkAdapter,iProgress);
  ComputeServiceContext context=TestUtils.computeServiceForLocalhostAndGuest();
  IMachine iMachine=new IsoToIMachine(vbm,adminDisk,diskFormat,settingsFile,vmName,osTypeId,vmId,forceOverwrite,controllerIDE,context,hostId,guestId).apply(VirtualBoxConstants.VIRTUALBOX_DISTRO_ISO_NAME);
  assertEquals(iMachine.getName(),vmName);
}
