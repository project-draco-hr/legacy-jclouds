{
  PaginatedSet<Metric> response;
  String testNamespace=Namespaces.EC2;
  String testMetricName=EC2Constants.MetricName.CPU_UTILIZATION;
  String testDimensionName=EC2Constants.Dimension.INSTANCE_TYPE;
  String testDimensionValue="t1.micro";
  response=client().list();
  performDefaultMetricsTests(response);
  if (response.size() > 0) {
    Metric metric=response.iterator().next();
    testMetricName=metric.getMetricName();
    testNamespace=metric.getNamespace();
    if (metric.getDimensions().size() > 0) {
      Dimension dimension=metric.getDimensions().iterator().next();
      testDimensionName=dimension.getName();
      testDimensionValue=dimension.getValue();
    }
    if (testDimensionName == null) {
      for (      Metric metric1 : response) {
        Set<Dimension> dimensions=metric1.getDimensions();
        if (dimensions.size() > 0) {
          Dimension dimension=metric.getDimensions().iterator().next();
          testDimensionName=dimension.getName();
          testDimensionValue=dimension.getValue();
          break;
        }
      }
    }
  }
  response=client().list(ListMetricsOptions.Builder.nextMarker(response.getNextMarker()));
  performDefaultMetricsTests(response);
  response=client().list(ListMetricsOptions.Builder.namespace(testNamespace));
  performDefaultMetricsTests(response);
  for (  Metric metric : response) {
    checkArgument(metric.getNamespace().equals(testNamespace),"All metrics should have the " + testNamespace + " Namespace.");
  }
  response=client().list(ListMetricsOptions.Builder.metricName(testMetricName));
  performDefaultMetricsTests(response);
  for (  Metric metric : response) {
    checkArgument(metric.getMetricName().equals(testMetricName),"All metrics should have the " + testMetricName + " MetricName.");
  }
  if (testDimensionName != null) {
    Dimension testDimension=new Dimension(testDimensionName,testDimensionValue);
    response=client().list(ListMetricsOptions.Builder.dimension(testDimension));
    performDefaultMetricsTests(response);
    for (    Metric metric : response) {
      Set<Dimension> dimensions=metric.getDimensions();
      checkArgument(dimensions.size() == 1,"There should only be one Dimension.");
      Dimension dimension=dimensions.iterator().next();
      checkArgument(dimension.equals(testDimension),"The retrieved Dimension and test Dimension should be equal.");
    }
  }
}
