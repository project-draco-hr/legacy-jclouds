{
  VCloudClient client=createMock(VCloudClient.class);
  GetExtra getExtra=new GetExtra();
  VCloudComputeClient computeClient=createMock(VCloudComputeClient.class);
  Map<VAppStatus,NodeState> vAppStatusToNodeState=Maps.newHashMap();
  VApp vApp=newVApp();
  expect(client.getVApp("10")).andThrow(new NullPointerException());
  expect(client.getVApp("10")).andThrow(new NullPointerException());
  expect(client.getVApp("10")).andReturn(vApp);
  replay(client);
  replay(computeClient);
  Location vdcL=new LocationImpl(LocationScope.ZONE,"1","1",null);
  Provider<Set<? extends Location>> locations=Providers.<Set<? extends Location>>of(ImmutableSet.of(vdcL));
  Provider<Set<? extends Image>> images=Providers.<Set<? extends Image>>of(ImmutableSet.<Image>of());
  FindLocationForResourceInVDC findLocationForResourceInVDC=new FindLocationForResourceInVDC(locations,null);
  VCloudListNodesStrategy strategy=new VCloudListNodesStrategy(client,computeClient,vAppStatusToNodeState,getExtra,findLocationForResourceInVDC,images);
  Set<NodeMetadata> nodes=Sets.newHashSet();
  NamedResource vdc=new NamedResourceImpl("1",null,null,null);
  NamedResource resource=new NamedResourceImpl("10",null,null,null);
  strategy.addVAppToSetRetryingIfNotYetPresent(nodes,vdc,resource);
  verify(client);
  verify(computeClient);
}
