{
  VApp vApp=client.getVApp(id);
  String tag=null;
  Image image=null;
  Matcher matcher=TAG_PATTERN_WITH_TEMPLATE.matcher(vApp.getName());
  if (matcher.find()) {
    tag=matcher.group(1);
    String templateIdInHexWithoutLeadingZeros=matcher.group(2).replaceAll("^[0]+","");
    String templateId=Integer.parseInt(templateIdInHexWithoutLeadingZeros,16) + "";
    image=images.get(templateId);
  }
 else {
    matcher=TAG_PATTERN_WITHOUT_TEMPLATE.matcher(vApp.getName());
    if (matcher.find()) {
      tag=matcher.group(1);
    }
 else {
      tag="NOTAG-" + vApp.getName();
    }
  }
  return new NodeMetadataImpl(vApp.getId(),vApp.getName(),locations.get(vDCId),vApp.getLocation(),ImmutableMap.<String,String>of(),tag,image,vAppStatusToNodeState.get(vApp.getStatus()),computeClient.getPublicAddresses(id),computeClient.getPrivateAddresses(id),getExtra.apply(vApp),null);
}
