{
  Set<NodeMetadata> allocatedNodes=Sets.newLinkedHashSet();
  for (  ComputeMetadata node : backingComputeService.listNodes()) {
    NodeMetadata metadata=backingComputeService.getNodeMetadata(node.getId());
    String group=groupMapping.get(node);
    if ("unassigned".equals(group))     continue;
    NodeMetadata nodeWithUpdatedGroup=NodeMetadataBuilder.fromNodeMetadata(metadata).group(group).build();
    allocatedNodes.add(nodeWithUpdatedGroup);
  }
  return allocatedNodes;
}
