{
  Builder<Long> jobsToTrack=ImmutableSet.builder();
  Set<Long> ipAddresses=Sets.newLinkedHashSet();
  Set<IPForwardingRule> forwardingRules=client.getNATClient().getIPForwardingRulesForVirtualMachine(virtualMachineId);
  for (  IPForwardingRule rule : forwardingRules) {
    if (!"Deleting".equals(rule.getState())) {
      ipAddresses.add(rule.getIPAddressId());
      Long deleteForwardingRule=client.getNATClient().deleteIPForwardingRule(rule.getId());
      if (deleteForwardingRule != null) {
        logger.debug(">> deleting IPForwardingRule(%s) job(%s)",rule.getId(),deleteForwardingRule);
        jobsToTrack.add(deleteForwardingRule);
      }
    }
  }
  awaitCompletion(jobsToTrack.build());
  return ipAddresses;
}
