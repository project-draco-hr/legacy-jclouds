{
  String toSign=createStringToSign();
  String signatureMd5=getMd5For(toSign);
  String query=request.getEndpoint().getQuery();
  Multimap<String,String> decodedParams=ModifyRequest.parseQueryToMap(query);
  decodedParams.replaceValues("sig",ImmutableSet.of(signatureMd5));
  decodedParams.replaceValues("api_key",ImmutableSet.of(apiKey));
  String updatedQuery=ModifyRequest.makeQueryLine(decodedParams,null);
  String requestBasePart=request.getEndpoint().toASCIIString();
  String updatedEndpoint=requestBasePart.substring(0,requestBasePart.indexOf("?") + 1) + updatedQuery;
  request=request.toBuilder().endpoint(URI.create(updatedEndpoint)).build();
  utils.logRequest(signatureLog,request,"<<");
  return request;
}
