{
  String keyPairName=prefix + "-windows-keypair";
  client.getSSHKeyPairClient().deleteSSHKeyPair(keyPairName);
  SshKeyPair keyPair=client.getSSHKeyPairClient().createSSHKeyPair(keyPairName);
  String group=prefix + "-windows-test";
  Template template=computeContext.getComputeService().templateBuilder().imageId("290").locationId("1").options(new CloudStackTemplateOptions().setupStaticNat(false).keyPair(keyPairName)).build();
  NodeMetadata node=null;
  try {
    node=getOnlyElement(computeContext.getComputeService().createNodesInGroup(group,1,template));
    String encryptedPassword=client.getVirtualMachineClient().getEncryptedPasswordForVirtualMachine(Long.parseLong(node.getId()));
    Crypto crypto=new BouncyCastleCrypto();
    WindowsLoginCredentialsFromEncryptedData passwordDecrypt=new WindowsLoginCredentialsFromEncryptedData(crypto);
    assertEquals(passwordDecrypt.apply(new EncryptedPasswordAndPrivateKey(encryptedPassword,keyPair.getPrivateKey())).getPassword(),"bX7vvptvw");
  }
  finally {
    if (node != null) {
      computeContext.getComputeService().destroyNode(node.getId());
    }
  }
}
