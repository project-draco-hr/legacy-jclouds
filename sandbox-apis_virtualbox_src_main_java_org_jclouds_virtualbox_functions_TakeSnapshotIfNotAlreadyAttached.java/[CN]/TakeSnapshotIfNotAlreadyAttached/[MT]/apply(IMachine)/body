{
  ISession session=null;
  if (machine.getCurrentSnapshot() == null) {
    try {
      session=manager.openMachineSession(machine);
      IProgress progress=session.getConsole().takeSnapshot(snapshotName,snapshotDesc);
      if (progress.getCompleted())       logger.debug("Snapshot %s (description: %s) taken from %s",snapshotName,snapshotDesc,machine.getName());
    }
 catch (    Exception e) {
      logger.error(e,"Problem creating snapshot %s (descripton: %s) from machine %s",snapshotName,snapshotDesc,machine.getName());
      propogate(e);
    }
 finally {
      session.unlockMachine();
    }
  }
  return machine.getCurrentSnapshot();
}
