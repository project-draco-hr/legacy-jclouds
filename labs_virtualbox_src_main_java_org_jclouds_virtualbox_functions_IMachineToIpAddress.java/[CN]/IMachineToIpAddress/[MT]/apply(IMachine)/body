{
  String macAddress=machine.getNetworkAdapter(0l).getMACAddress();
  int offset=0;
  int step=2;
  for (int j=1; j <= 5; j++) {
    macAddress=new StringBuilder(macAddress).insert(j * step + offset,":").toString().toLowerCase();
    offset++;
  }
  String simplifiedMacAddressOfClonedVM=macAddress;
  final String hostId=System.getProperty(VirtualBoxConstants.VIRTUALBOX_HOST_ID);
  IMachine hostMachine=manager.getVBox().findMachine(hostId);
  if (isOSX(hostMachine)) {
    if (simplifiedMacAddressOfClonedVM.contains("00"))     simplifiedMacAddressOfClonedVM=new StringBuilder(simplifiedMacAddressOfClonedVM).delete(simplifiedMacAddressOfClonedVM.indexOf("00"),simplifiedMacAddressOfClonedVM.indexOf("00") + 1).toString();
    if (simplifiedMacAddressOfClonedVM.contains("0"))     if (simplifiedMacAddressOfClonedVM.indexOf("0") + 1 != ':' && simplifiedMacAddressOfClonedVM.indexOf("0") - 1 != ':')     simplifiedMacAddressOfClonedVM=new StringBuilder(simplifiedMacAddressOfClonedVM).delete(simplifiedMacAddressOfClonedVM.indexOf("0"),simplifiedMacAddressOfClonedVM.indexOf("0") + 1).toString();
  }
  ExecResponse execResponse=runScriptOnNode(hostId,"for i in {1..254} ; do ping -c 1 -t 1 192.168.2.$i & done",runAsRoot(false).wrapInInitScript(false));
  System.out.println(execResponse);
  String arpLine=runScriptOnNode(hostId,"arp -an | grep " + simplifiedMacAddressOfClonedVM,runAsRoot(false).wrapInInitScript(false)).getOutput();
  String ipAddress=arpLine.substring(arpLine.indexOf("(") + 1,arpLine.indexOf(")"));
  System.out.println("IP address " + ipAddress);
  return ipAddress;
}
