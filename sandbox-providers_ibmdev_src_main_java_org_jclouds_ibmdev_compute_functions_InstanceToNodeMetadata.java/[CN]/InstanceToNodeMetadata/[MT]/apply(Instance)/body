{
  String group=parseGroupFromName(from.getName());
  Set<String> ipSet=from.getIp() != null ? ImmutableSet.of(from.getIp()) : ImmutableSet.<String>of();
  Image image=images.get().get(from.getImageId());
  String key=group != null ? credentialsMap.get(group) : null;
  return new NodeMetadataBuilder().ids(from.getId() + "").name(from.getName()).location(locations.get().get(image.getLocation())).group(group).imageId(from.getImageId()).state(instanceStateToNodeState.get(from.getStatus())).operatingSystem(image != null ? image.getOperatingSystem() : null).publicAddresses(ipSet).credentials(new Credentials(image.getDefaultCredentials().identity,key)).build();
}
