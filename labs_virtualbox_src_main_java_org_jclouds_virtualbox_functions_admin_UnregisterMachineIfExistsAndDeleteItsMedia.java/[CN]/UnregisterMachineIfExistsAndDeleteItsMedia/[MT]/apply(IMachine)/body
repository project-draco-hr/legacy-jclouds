{
  List<IMedium> mediaToBeDeleted=ImmutableList.of();
  try {
    mediaToBeDeleted=machine.unregister(vmSpec.getCleanupMode());
  }
 catch (  VBoxException e) {
    ErrorCode errorCode=ErrorCode.valueOf(e);
switch (errorCode) {
case VBOX_E_OBJECT_NOT_FOUND:
      logger.debug("Machine %s does not exists, cannot unregister",vmSpec.getVmName());
    break;
default :
  throw e;
}
}
List<IMedium> filteredMediaToBeDeleted=Lists.newArrayList(transform(filter(mediaToBeDeleted,new AutoDeleteHardDiskPredicate(vmSpec)),new DeleteChildrenOfMedium()));
if (!filteredMediaToBeDeleted.isEmpty()) {
try {
IProgress deletion=machine.delete(filteredMediaToBeDeleted);
deletion.waitForCompletion(-1);
}
 catch (Exception e) {
logger.error(e,"Problem in deleting the media attached to %s",machine.getName());
Throwables.propagate(e);
}
}
return null;
}
