{
  URI org=URI.create("org1");
  String identity="identity";
  String tag="tag";
  OrgAndName orgAndName=new OrgAndName(org,"tag");
  String systemGeneratedFingerprint="systemGeneratedKeyPairfinger";
  TerremarkVCloudTemplateOptions options=new TerremarkVCloudTemplateOptions();
  CreateNewKeyPairUnlessUserSpecifiedOtherwise strategy=setupStrategy();
  KeyPairCredentials keyPairCredentials=createMock(KeyPairCredentials.class);
  KeyPair keyPair=createMock(KeyPair.class);
  expect(strategy.credentialsMap.containsKey(orgAndName)).andReturn(true);
  expect(strategy.credentialsMap.get(orgAndName)).andReturn(keyPairCredentials);
  expect(keyPairCredentials.getKeyPair()).andReturn(keyPair);
  expect(keyPair.getFingerPrint()).andReturn(systemGeneratedFingerprint).atLeastOnce();
  replay(keyPair);
  replay(keyPairCredentials);
  replayStrategy(strategy);
  strategy.execute(org,tag,identity,options);
  assertEquals(options.getSshKeyFingerprint(),"systemGeneratedKeyPairfinger");
  verify(keyPair);
  verify(keyPairCredentials);
  verifyStrategy(strategy);
}
