{
  Map<InstanceState,NodeState> instanceToNodeState=EC2ComputeServiceContextModule.instanceToNodeState;
  Map<RegionAndName,Image> instanceToImage=Maps.uniqueIndex(images,new Function<Image,RegionAndName>(){
    @Override public RegionAndName apply(    Image from){
      return new RegionAndName(from.getLocation().getId(),from.getProviderId());
    }
  }
);
  Supplier<Set<? extends Location>> locationSupplier=new Supplier<Set<? extends Location>>(){
    @Override public Set<? extends Location> get(){
      return locations;
    }
  }
;
  Supplier<Set<? extends Hardware>> hardwareSupplier=new Supplier<Set<? extends Hardware>>(){
    @Override public Set<? extends Hardware> get(){
      return hardware;
    }
  }
;
  RunningInstanceToNodeMetadata parser=new RunningInstanceToNodeMetadata(instanceToNodeState,credentialStore,instanceToImage,locationSupplier,hardwareSupplier);
  return parser;
}
