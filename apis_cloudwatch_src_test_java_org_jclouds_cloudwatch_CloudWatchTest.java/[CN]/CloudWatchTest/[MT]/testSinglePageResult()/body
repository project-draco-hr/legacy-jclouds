{
  CloudWatchClient client=createMock(CloudWatchClient.class);
  MetricClient metricClient=createMock(MetricClient.class);
  ListMetricsOptions options=new ListMetricsOptions();
  PaginatedIterable<Metric> response=PaginatedIterables.forwardWithMarker(ImmutableSet.of(createMock(Metric.class)),null);
  expect(client.getMetricClientForRegion(null)).andReturn(metricClient).atLeastOnce();
  expect(metricClient.list(options)).andReturn(response).once();
  EasyMock.replay(client,metricClient);
  Assert.assertEquals(1,Iterables.size(CloudWatch.listMetrics(client,null,options)));
}
