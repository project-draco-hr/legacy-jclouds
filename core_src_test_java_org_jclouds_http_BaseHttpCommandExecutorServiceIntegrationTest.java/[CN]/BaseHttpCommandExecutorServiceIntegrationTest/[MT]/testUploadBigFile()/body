{
  String filename="jclouds";
  OutputStream os=null;
  File f=null;
  try {
    f=File.createTempFile(filename,"tmp");
    f.deleteOnExit();
    long length=(long)(Runtime.getRuntime().freeMemory() * 1.1);
    os=new BufferedOutputStream(new FileOutputStream(f.getAbsolutePath()));
    MessageDigest eTag;
    try {
      eTag=MessageDigest.getInstance("MD5");
    }
 catch (    NoSuchAlgorithmException e) {
      throw new RuntimeException("Could not find the MD5 algorithm",e);
    }
    ByteArrayOutputStream out=new ByteArrayOutputStream();
    try {
      for (long i=0; i < length; i++) {
        eTag.update((byte)'a');
        os.write((byte)'a');
      }
      os.flush();
    }
 catch (    IOException e) {
      throw new RuntimeException(e);
    }
 finally {
      Closeables.closeQuietly(out);
    }
    assertEquals(client.postWithMd5("fileso",CryptoStreams.base64Encode(InputSuppliers.of(eTag.digest())),f).trim(),"created");
  }
  finally {
    if (os != null)     os.close();
    if (f != null && f.exists())     f.delete();
  }
}
