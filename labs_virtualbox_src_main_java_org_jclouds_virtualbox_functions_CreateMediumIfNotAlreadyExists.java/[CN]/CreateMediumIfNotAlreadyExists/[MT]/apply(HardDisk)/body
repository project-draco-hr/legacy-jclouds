{
  IVirtualBox vBox=manager.get().getVBox();
  try {
    String diskPath=hardDisk.getDiskPath();
    final IMedium medium=vBox.openMedium(diskPath,DeviceType.HardDisk,AccessMode.ReadWrite,false);
    if (overwriteIfExists) {
      try {
        deleteMediumAndBlockUntilComplete(medium);
      }
 catch (      VBoxException e) {
        onAlreadyAttachedExceptionDetachOrPropagate(vBox,medium,e);
      }
      return createNewMedium(vBox,hardDisk);
    }
 else {
      throw new IllegalStateException("Medium for path " + diskPath + " already exists.");
    }
  }
 catch (  VBoxException e) {
    if (notFoundException(e))     return createNewMedium(vBox,hardDisk);
    throw e;
  }
}
