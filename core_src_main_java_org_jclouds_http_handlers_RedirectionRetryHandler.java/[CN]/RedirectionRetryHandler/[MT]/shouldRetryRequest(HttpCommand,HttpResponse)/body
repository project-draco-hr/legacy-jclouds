{
  closeClientButKeepContentStream(response);
  String hostHeader=response.getFirstHeaderOrNull(HttpHeaders.LOCATION);
  if (hostHeader != null && command.incrementRedirectCount() < retryCountLimit) {
    URI redirectionUrl=uriBuilderProvider.get().uri(URI.create(hostHeader)).build();
    if (redirectionUrl.getScheme().equals(command.getRequest().getEndpoint().getScheme()) && redirectionUrl.getHost().equals(command.getRequest().getEndpoint().getHost()) && redirectionUrl.getPort() == command.getRequest().getEndpoint().getPort()) {
      if (!redirectionUrl.getPath().equals(command.getRequest().getEndpoint().getPath())) {
        changePathTo(command.getRequest(),redirectionUrl.getPath(),uriBuilderProvider.get());
      }
 else {
        return backoffHandler.shouldRetryRequest(command,response);
      }
    }
 else {
      changeSchemeHostAndPortTo(command.getRequest(),redirectionUrl.getScheme(),redirectionUrl.getHost(),redirectionUrl.getPort(),uriBuilderProvider.get());
    }
    return true;
  }
 else {
    return false;
  }
}
