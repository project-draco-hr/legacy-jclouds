{
  HttpUriRequest apacheRequest;
  if (request.getMethod().equals(HttpMethod.HEAD)) {
    apacheRequest=new HttpHead(request.getEndpoint());
  }
 else   if (request.getMethod().equals(HttpMethod.GET)) {
    apacheRequest=new HttpGet(request.getEndpoint());
  }
 else   if (request.getMethod().equals(HttpMethod.DELETE)) {
    apacheRequest=new HttpDelete(request.getEndpoint());
  }
 else   if (request.getMethod().equals(HttpMethod.PUT)) {
    apacheRequest=new HttpPut(request.getEndpoint());
  }
 else   if (request.getMethod().equals(HttpMethod.POST)) {
    apacheRequest=new HttpPost(request.getEndpoint());
  }
 else {
    throw new UnsupportedOperationException(request.getMethod());
  }
  Payload payload=request.getPayload();
  if (apacheRequest instanceof HttpEntityEnclosingRequest) {
    if (payload != null) {
      addEntityForContent(HttpEntityEnclosingRequest.class.cast(apacheRequest),payload);
    }
  }
 else {
    apacheRequest.addHeader(HttpHeaders.CONTENT_LENGTH,"0");
  }
  for (  String header : request.getHeaders().keySet()) {
    for (    String value : request.getHeaders().get(header))     if (!header.equals(HttpHeaders.CONTENT_LENGTH))     apacheRequest.addHeader(header,value);
  }
  apacheRequest.addHeader(HttpHeaders.USER_AGENT,USER_AGENT);
  return apacheRequest;
}
