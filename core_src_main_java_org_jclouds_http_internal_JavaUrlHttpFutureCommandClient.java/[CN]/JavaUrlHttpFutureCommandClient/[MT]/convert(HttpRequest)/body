{
  URL url=new URL(request.getEndPoint().toURL(),request.getUri());
  HttpURLConnection connection=(HttpURLConnection)url.openConnection();
  connection.setDoOutput(true);
  connection.setAllowUserInteraction(false);
  connection.setInstanceFollowRedirects(true);
  connection.setRequestMethod(request.getMethod().toString());
  for (  String header : request.getHeaders().keySet()) {
    for (    String value : request.getHeaders().get(header))     connection.setRequestProperty(header,value);
  }
  if (request.getPayload() != null) {
    OutputStream out=connection.getOutputStream();
    try {
      if (request.getPayload() instanceof String) {
        OutputStreamWriter writer=new OutputStreamWriter(out);
        writer.write((String)request.getPayload());
        writer.close();
      }
 else       if (request.getPayload() instanceof InputStream) {
        IOUtils.copy((InputStream)request.getPayload(),out);
      }
 else       if (request.getPayload() instanceof File) {
        IOUtils.copy(new FileInputStream((File)request.getPayload()),out);
      }
 else       if (request.getPayload() instanceof byte[]) {
        IOUtils.write((byte[])request.getPayload(),out);
      }
 else {
        throw new UnsupportedOperationException("Content not supported " + request.getPayload().getClass());
      }
    }
  finally {
      IOUtils.closeQuietly(out);
    }
  }
 else {
    connection.setRequestProperty(HttpConstants.CONTENT_LENGTH,"0");
  }
  return connection;
}
